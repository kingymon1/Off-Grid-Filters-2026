---
import { siteConfig } from '../lib/config';

const categories = siteConfig.navigation.categories;
const hubUrl = siteConfig.navigation.hubUrl;
const hubLabel = siteConfig.navigation.hubLabel;
---

<header id="header" class="header">
  <div class="header-glow"></div>
  <nav class="container nav-container">
    <a href="/" class="logo">
      <div class="logo-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
      </div>
      <div class="logo-text">
        <span class="logo-name">{siteConfig.brand}</span>
        <span class="logo-tagline">{siteConfig.brandTagline}</span>
      </div>
    </a>

    <!-- Desktop Navigation -->
    <div class="desktop-nav">
      {Object.entries(categories).map(([category, links]) => (
        <div class="nav-dropdown">
          <button class="nav-btn" aria-expanded="false" aria-haspopup="true">
            {category}
            <svg class="chevron" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
          </button>
          <div class="dropdown-menu" role="menu">
            <div class="dropdown-content">
              <div class="dropdown-accent"></div>
              {links.map((link) => (
                <a href={link.url} class="dropdown-link" role="menuitem">
                  <span class="link-dot"></span>
                  {link.title}
                </a>
              ))}
            </div>
          </div>
        </div>
      ))}
      <a href={hubUrl} class="nav-link">{hubLabel}</a>
    </div>

    <!-- Mobile Menu Button -->
    <button id="mobile-menu-btn" class="mobile-menu-btn" aria-label="Toggle menu">
      <svg id="menu-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
      <svg id="close-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
    </button>
  </nav>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="mobile-menu hidden">
    {Object.entries(categories).map(([category, links]) => (
      <details class="mobile-category">
        <summary class="mobile-category-title">
          {category}
          <svg class="mobile-chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
        </summary>
        <div class="mobile-links">
          {links.map((link) => (
            <a href={link.url} class="mobile-link">{link.title}</a>
          ))}
        </div>
      </details>
    ))}
    <a href={hubUrl} class="mobile-all-guides">{hubLabel}</a>
  </div>
</header>

<style>
  .header { position: sticky; top: 0; z-index: 50; width: 100%; border-bottom: 1px solid transparent; background-color: hsl(var(--background) / 0.6); backdrop-filter: blur(20px) saturate(180%); -webkit-backdrop-filter: blur(20px) saturate(180%); transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
  .header-glow { position: absolute; bottom: -1px; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, hsl(var(--primary) / 0), hsl(var(--primary) / 0.3), hsl(var(--primary) / 0), transparent); opacity: 0; transition: opacity 0.4s; }
  .header.scrolled { background-color: hsl(var(--background) / 0.85); border-color: hsl(var(--border) / 0.3); }
  .header.scrolled .header-glow { opacity: 1; }
  .nav-container { display: flex; align-items: center; justify-content: space-between; height: 4.5rem; }
  .logo { display: flex; align-items: center; gap: 0.75rem; transition: opacity 0.2s; }
  .logo:hover { opacity: 0.9; }
  .logo-icon { background: linear-gradient(135deg, hsl(var(--primary)), hsl(var(--primary-warm))); padding: 0.5rem; border-radius: 0.625rem; color: hsl(var(--background)); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1), box-shadow 0.3s; box-shadow: 0 2px 8px -2px hsl(var(--primary) / 0.3); }
  .logo:hover .logo-icon { transform: scale(1.08) rotate(-3deg); box-shadow: 0 4px 16px -2px hsl(var(--primary) / 0.4); }
  .logo-text { display: flex; flex-direction: column; }
  .logo-name { font-size: 1.25rem; font-weight: 800; letter-spacing: -0.03em; transition: color 0.3s; }
  .logo:hover .logo-name { color: hsl(var(--primary)); }
  .logo-tagline { font-size: 0.625rem; text-transform: uppercase; letter-spacing: 0.12em; color: hsl(var(--muted-foreground)); margin-top: -2px; font-weight: 500; }
  .desktop-nav { display: none; align-items: center; gap: 0.25rem; }
  @media (min-width: 1024px) { .desktop-nav { display: flex; } }
  .nav-dropdown { position: relative; }
  .nav-btn { display: flex; align-items: center; gap: 0.375rem; padding: 0.5rem 0.75rem; font-size: 0.875rem; font-weight: 500; color: hsl(var(--muted-foreground)); background: none; border: none; cursor: pointer; transition: color 0.2s; border-radius: 0.5rem; }
  .nav-btn:hover { color: hsl(var(--foreground)); }
  .chevron { color: hsl(var(--muted-foreground)); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
  .nav-dropdown:hover .chevron, .nav-dropdown:focus-within .chevron { transform: rotate(180deg); }
  .dropdown-menu { position: absolute; top: 100%; left: 50%; transform: translateX(-50%) translateY(4px); padding-top: 0.75rem; opacity: 0; visibility: hidden; transition: all 0.25s cubic-bezier(0.16, 1, 0.3, 1); }
  .nav-dropdown:hover .dropdown-menu, .nav-dropdown:focus-within .dropdown-menu { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }
  .nav-btn:focus-visible { outline: 2px solid hsl(var(--primary)); outline-offset: 2px; border-radius: 0.5rem; }
  .dropdown-link:focus-visible { outline: 2px solid hsl(var(--primary)); outline-offset: -2px; background-color: hsl(var(--primary) / 0.05); color: hsl(var(--primary)); }
  .dropdown-content { background-color: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 1rem; box-shadow: 0 0 0 1px hsl(var(--border) / 0.5), 0 20px 60px -12px rgba(0, 0, 0, 0.5), 0 0 20px -4px hsl(var(--primary) / 0.05); overflow: hidden; padding: 0.5rem; min-width: 260px; max-width: 300px; position: relative; }
  .dropdown-accent { position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, hsl(var(--primary)), hsl(var(--primary-warm)), hsl(var(--primary))); }
  .dropdown-link { display: flex; align-items: center; gap: 0.75rem; padding: 0.625rem 0.875rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 500; color: hsl(var(--muted-foreground)); transition: all 0.2s; }
  .dropdown-link:hover { background-color: hsl(var(--primary) / 0.08); color: hsl(var(--foreground)); }
  .link-dot { width: 5px; height: 5px; border-radius: 50%; background-color: hsl(var(--border)); transition: all 0.2s; flex-shrink: 0; }
  .dropdown-link:hover .link-dot { background-color: hsl(var(--primary)); box-shadow: 0 0 6px hsl(var(--primary) / 0.4); }
  .nav-link { padding: 0.5rem 0.75rem; font-size: 0.875rem; font-weight: 500; color: hsl(var(--muted-foreground)); transition: color 0.2s; border-radius: 0.5rem; }
  .nav-link:hover { color: hsl(var(--primary)); }
  .nav-link:focus-visible { outline: 2px solid hsl(var(--primary)); outline-offset: 2px; border-radius: 0.5rem; }
  .mobile-menu-btn { display: block; padding: 0.5rem; border-radius: 0.5rem; background: none; border: none; color: hsl(var(--foreground)); cursor: pointer; transition: all 0.2s; }
  .mobile-menu-btn:hover { background-color: hsl(var(--muted) / 0.5); }
  @media (min-width: 1024px) { .mobile-menu-btn { display: none; } }
  .hidden { display: none !important; }
  .mobile-menu { border-top: 1px solid hsl(var(--border) / 0.3); padding: 1rem; max-height: calc(100vh - 4.5rem); overflow-y: auto; background-color: hsl(var(--background) / 0.98); backdrop-filter: blur(20px); }
  @media (min-width: 1024px) { .mobile-menu { display: none !important; } }
  .mobile-category { margin-bottom: 0.25rem; border: none; border-radius: 0.75rem; }
  .mobile-category:hover { border-color: transparent; }
  .mobile-category summary { display: flex; align-items: center; justify-content: space-between; padding: 0.75rem 1rem; font-weight: 600; font-size: 0.9375rem; border-radius: 0.75rem; border: none; color: hsl(var(--foreground)); }
  .mobile-category[open] summary { border-bottom: none; color: hsl(var(--primary)); }
  .mobile-chevron { transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
  .mobile-category[open] .mobile-chevron { transform: rotate(180deg); }
  .mobile-links { padding: 0 0.5rem 0.5rem; }
  .mobile-link { display: block; padding: 0.5rem 1rem; font-size: 0.875rem; color: hsl(var(--muted-foreground)); border-radius: 0.5rem; transition: all 0.2s; }
  .mobile-link:hover { color: hsl(var(--primary)); background-color: hsl(var(--primary) / 0.08); }
  .mobile-all-guides { display: block; padding: 0.75rem 1rem; font-weight: 600; border-radius: 0.75rem; transition: all 0.2s; margin-top: 0.25rem; color: hsl(var(--foreground)); }
  .mobile-all-guides:hover { color: hsl(var(--primary)); background-color: hsl(var(--muted) / 0.5); }
</style>

<script>
  const header = document.getElementById('header');
  window.addEventListener('scroll', () => {
    if (window.scrollY > 20) { header?.classList.add('scrolled'); } else { header?.classList.remove('scrolled'); }
  });
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');
  mobileMenuBtn?.addEventListener('click', () => { mobileMenu?.classList.toggle('hidden'); menuIcon?.classList.toggle('hidden'); closeIcon?.classList.toggle('hidden'); });
  mobileMenu?.querySelectorAll('a').forEach(link => { link.addEventListener('click', () => { mobileMenu?.classList.add('hidden'); menuIcon?.classList.remove('hidden'); closeIcon?.classList.add('hidden'); }); });
  document.querySelectorAll('.nav-dropdown').forEach(dropdown => {
    const btn = dropdown.querySelector('.nav-btn');
    dropdown.addEventListener('keydown', (e) => { if (e.key === 'Escape') { btn?.focus(); btn?.setAttribute('aria-expanded', 'false'); } });
    btn?.addEventListener('focus', () => { btn.setAttribute('aria-expanded', 'true'); });
    dropdown.addEventListener('focusout', (e) => { if (!dropdown.contains((e as FocusEvent).relatedTarget as Node)) { btn?.setAttribute('aria-expanded', 'false'); } });
    dropdown.addEventListener('mouseenter', () => { btn?.setAttribute('aria-expanded', 'true'); });
    dropdown.addEventListener('mouseleave', () => { btn?.setAttribute('aria-expanded', 'false'); });
  });
</script>
