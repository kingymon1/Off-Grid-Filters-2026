---
import ContentLayout from '../layouts/ContentLayout.astro';
import ProductImage from '../components/ProductImage.astro';
import ComparisonTable from '../components/ComparisonTable.astro';
import ProTip from '../components/ProTip.astro';
import { getProductsByCategory, getCategoryBySlug, getAffiliateUrl, isPublished, getPriceTier } from '../lib/config';
import { generateItemListSchema, generateFAQSchema, generateArticleSchema, combineSchemas } from '../lib/schema';

const categorySlug = 'survival-filters';
const category = getCategoryBySlug(categorySlug)!;
if (!isPublished(category.publishDate)) return Astro.redirect('/404');

const allProducts = getProductsByCategory(categorySlug);
const publishedProducts = allProducts.filter(p => isPublished(p.publishDate));
const year = new Date().getFullYear();

// Top picks for the comparison table — limit to 6 diverse picks to keep the table readable.
// The full list of all products is shown in the individual mini-reviews below.
const topPickSlugs = [
  'sawyer-squeeze-water-filtration-system',       // Best Overall
  'sawyer-products-mini-water-filtration-system',  // Best Ultralight
  'grayl-geopress-24oz-water-purifier-bottle',     // Best Purifier
  'katadyn-befree-1-0l-water-filter-bottle',       // Fastest Flow
  'platypus-gravityworks-4-0l-water-filter-system', // Best Gravity
  'lifestraw-family-1-0-portable-gravity-powered-water-purifier', // Best for Families
];
const topPicks = topPickSlugs
  .map(slug => publishedProducts.find(p => p.slug === slug))
  .filter((p): p is NonNullable<typeof p> => p != null);

const tableProducts = topPicks.map((p, i) => ({
  name: p.shortName || p.name,
  asin: p.asin,
  rating: p.rating,
  price: p.price,
  filtrationTechnology: p.specs.filtrationTechnology || '',
  micronRating: p.specs.micronRating || '',
  capacity: p.specs.capacity || '',
  flowRate: p.specs.flowRate || '',
  filterLife: p.specs.filterLife || '',
  weight: p.specs.weight || '',
  isEditorsPick: i === 0,
}));

const faqs = [
  { question: 'Do survival filter straws remove viruses?', answer: 'No. Filter straws with 0.1-micron hollow fiber or ultrafiltration membranes effectively remove bacteria (99.9999%) and protozoa (99.99%), but viruses are too small (0.02-0.3 microns) to be caught by 0.1-micron filters. For virus protection, pair a filter straw with chemical purification tablets like MSR Aquatabs, or use a UV purifier. This is especially important for international travel where waterborne viruses are a real risk.' },
  { question: 'How long do survival filter straws really last?', answer: 'Manufacturers typically claim 1,500 liters per straw, but real-world performance varies. In clear mountain streams, a straw can approach its rated capacity. In turbid or sediment-heavy water, the membrane clogs much faster and may last only 500-800 liters. Pre-filtering through a bandana or cloth to remove visible sediment significantly extends filter life. When flow rate drops noticeably, it is time to replace.' },
  { question: 'What is the best water purification method for emergencies?', answer: 'The best emergency water strategy uses two complementary methods: a filter straw to remove bacteria, protozoa, and sediment, plus chemical purification tablets to kill viruses. This dual approach covers all biological threats. Store at least one filter straw and a pack of Aquatabs in every emergency kit. For long-term emergencies, a gravity-fed filter system provides higher volume with less effort.' },
  { question: 'Can I use a survival filter straw with any water source?', answer: 'Filter straws are designed for natural freshwater sources: streams, rivers, lakes, ponds, and rainwater collection. They should NOT be used with saltwater, chemically contaminated water (industrial runoff, agricultural chemicals), or water with dissolved heavy metals. Filters remove biological and physical contaminants but cannot remove dissolved chemicals, pesticides, or salt. Always use the cleanest available water source.' },
  { question: 'How do purification tablets compare to filter straws?', answer: 'They serve different purposes and work best together. Filter straws physically remove bacteria, protozoa, and sediment for instant drinking. Purification tablets (like Aquatabs) chemically kill viruses, bacteria, and some cysts, but require 30 minutes of wait time and do not remove sediment or improve taste. The ideal field protocol: filter first to remove physical contaminants, then treat with tablets for virus protection.' },
  { question: 'What survival water filter should I put in my bug-out bag?', answer: 'For a bug-out bag, we recommend the Timain 4-Stage Filter Straw 2-pack plus MSR Aquatabs. Both are budget-friendly — together they cost less than a single purifier bottle. The two filter straws weigh virtually nothing, provide 3,000 liters of combined bacterial filtration, and the Aquatabs add virus protection. You get comprehensive water purification capability weighing under 5 ounces for a fraction of the price of premium alternatives.' },
];

const itemListSchema = generateItemListSchema(
  publishedProducts.map((p, i) => ({
    name: p.name,
    url: `/reviews/${p.slug}/`,
    position: i + 1,
  }))
);
const articleSchema = generateArticleSchema({
  title: `Best ${category.name} ${year}: Expert Picks`,
  description: `We tested ${allProducts.length} survival and portable water filters. Here are the best for ${year}, ranked by filtration effectiveness, weight, durability, and value.`,
  url: `/best-${categorySlug}/`,
  datePublished: category.publishDate,
  dateModified: '2026-02-15',
  about: [{ name: category.name, url: 'https://www.wikidata.org/entity/Q842467' }],
});
const faqSchema = generateFAQSchema(faqs);
const schema = combineSchemas(articleSchema, itemListSchema, faqSchema);

const relatedArticles = [
  { title: 'Water Filters for Camping', url: '/water-filters-for-camping/', description: 'The best portable water filters for car camping, backpacking base camps, and group camping trips.' },
  { title: 'Water Filters for Emergency Preparedness', url: '/water-filters-for-emergencies/', description: 'Build a complete water purification kit for natural disasters and SHTF scenarios.' },
  { title: 'Water Filters for Hiking & Backpacking', url: '/water-filters-for-hiking/', description: 'Ultralight water filtration options for thru-hikers and backpackers.' },
  { title: 'How to Choose a Water Filter', url: '/guides/how-to-choose-water-filter/', description: 'Everything you need to know to pick the right water filter for your situation.' },
];
---

<ContentLayout
  title={`Best ${category.name} ${year} | OffGrid Filters`}
  description={`We tested ${allProducts.length} survival and portable water filters. Here are the best for ${year}, ranked by filtration effectiveness, weight, durability, and value.`}
  canonical={`/best-${categorySlug}/`}
  category="Best Of"
  currentPage={`Best ${category.name}`}
  schema={schema}
  relatedArticles={relatedArticles}
  lastUpdated="2026-02-15"
  heroImage={`/assets/best-${categorySlug}-hero.webp`}
>
  <h1>Best {category.name} {year}: Expert Picks</h1>
  <p class="lead">When you are miles from the nearest tap, your water filter is not a convenience — it is a lifeline. We tested {allProducts.length} survival and portable water purification products, from ultralight filter straws costing less than a fast-food meal to military-grade pump purifiers, to find the best options for hiking, camping, emergency preparedness, and off-grid living.</p>

  <ProductImage alt={`Best ${category.name} ${year}`} icon="camping" aspect="hero" slug="best-survival-filters" />

  <h2>Quick Picks: Our Top Recommendations</h2>
  <ComparisonTable products={tableProducts} />

  <ProTip title="Filter + Purification = Complete Protection">
    <p>No single portable product removes every waterborne threat. Filter straws and squeeze filters (0.1-0.2 micron) remove bacteria and protozoa but miss viruses. Purification tablets and purifiers (GRAYL, LifeSaver) kill viruses but may leave sediment. For complete protection in the field, combine a filter with chemical or press-based purification. Our top combo: pair a Sawyer Squeeze with MSR Aquatabs for comprehensive water purification at a total cost that is still well under the price of a single purifier bottle.</p>
  </ProTip>

  {publishedProducts.map((product, i) => (
    <section class="product-mini-review">
      <h3>{i + 1}. {product.name} — {product.bestFor}</h3>
      <ProductImage alt={product.name} icon="filter" aspect="wide" slug={product.slug} />
      <p>{product.verdict}</p>
      <p><strong>Key specs:</strong> {product.specs.filtrationTechnology}{product.specs.micronRating ? `, ${product.specs.micronRating} microns` : ''}{product.specs.capacity ? `, ${product.specs.capacity}` : ''}{product.specs.weight ? `, ${product.specs.weight}` : ''}. Priced at ${product.price}.</p>
      <div class="pros-cons-mini">
        <div class="pros-mini">
          <strong>Pros:</strong>
          <ul>
            {product.pros.slice(0, 3).map(p => (
              <li>{p}</li>
            ))}
          </ul>
        </div>
        <div class="cons-mini">
          <strong>Cons:</strong>
          <ul>
            {product.cons.slice(0, 2).map(c => (
              <li>{c}</li>
            ))}
          </ul>
        </div>
      </div>
      <p class="review-links">
        <a href={`/reviews/${product.slug}/`}>Read Full Review &rarr;</a> | <a href={getAffiliateUrl(product.asin)} target="_blank" rel="nofollow sponsored noopener">Check Price &rarr;</a>
      </p>
    </section>
  ))}

  <h2>How We Chose Our Picks</h2>
  <p>Survival water filtration demands a different evaluation framework than home filters. We prioritized <strong>biological threat removal effectiveness</strong> (log reduction rates for bacteria, protozoa, and viruses), <strong>weight and packability</strong> (every ounce matters in the field), <strong>reliability under adverse conditions</strong> (will it work after being bounced around in a pack for months?), <strong>ease of use under stress</strong> (can you use it effectively when cold, tired, or panicked?), and <strong>cost-to-coverage ratio</strong> (how much protection per dollar?).</p>
  <p>We also evaluated each product's role in a complete water treatment strategy. No single portable product removes all threats, so we assessed how well products complement each other. The filter + purification combination emerged as the most effective approach for comprehensive water safety across different scenarios.</p>

  <h2>Buying Guide: What to Look For in Survival Filters</h2>
  <p><strong>Understand what you are filtering against.</strong> Backcountry water in North America primarily contains bacteria (E. coli, Salmonella) and protozoa (Giardia, Cryptosporidium). A 0.1-micron filter handles both effectively. International travel adds virus risk (Hepatitis A, Norovirus), requiring chemical treatment, UV purification, or a purifier bottle like the GRAYL GeoPress. Flood water and industrial areas may contain chemicals that no portable filter can address.</p>
  <p><strong>Micron rating is the critical spec.</strong> For bacteria and protozoa removal, 0.1-0.2 microns is the standard. Purifiers (GRAYL, LifeSaver) and military-grade systems (MSR Guardian) reach 0.02 microns or finer to remove viruses. The 0.1-micron sweet spot provides biological safety with reasonable flow rates and filter longevity for most domestic backcountry use.</p>
  <p><strong>Match your filter type to your use case.</strong> Squeeze filters (Sawyer Squeeze, Katadyn BeFree) offer the best weight-to-performance ratio for solo backpacking. Gravity systems (MSR AutoFlow XL, Platypus GravityWorks) are ideal for groups and base camps. Pump filters (MSR MiniWorks EX, Katadyn Pocket) work in shallow or hard-to-reach water sources. Bottle purifiers (GRAYL GeoPress) provide the fastest complete purification for international travel. High-capacity jerrycan purifiers (LifeSaver Jerrycan) are ideal for vehicle-based overlanding and off-grid base camps.</p>

  <ProTip>
    <p>Never let a hollow fiber filter freeze. Ice crystals expand inside the microscopic fibers and create holes that allow bacteria to pass through. In cold weather, sleep with your filter inside your sleeping bag or keep it in an insulated pocket close to your body. If you suspect a filter has frozen, replace it — there is no way to test if the fibers are still intact.</p>
  </ProTip>

  <h2>Frequently Asked Questions</h2>
  <div class="faq-section">
    {faqs.map(faq => (
      <details class="faq-item">
        <summary>{faq.question}</summary>
        <div class="faq-answer">{faq.answer}</div>
      </details>
    ))}
  </div>

  <h2>Our Recommendation</h2>
  <div class="verdict-card">
    <p>For the best overall backcountry filter, the <strong>Sawyer Squeeze</strong> delivers unmatched value in the mid-range tier with its 100,000-gallon capacity and proven reliability — our top pick. For ultralight hikers, the <strong>Sawyer Mini</strong> is the lightest proven option at 2 ounces and one of the most affordable filters we tested. For complete virus protection without chemicals, the <strong>GRAYL GeoPress</strong> purifies water in 8 seconds and is worth the premium. Budget preppers should pair the <strong>Timain 4-Stage Filter Straw 2-Pack</strong> with <strong>MSR Aquatabs</strong> — together they cost less than most single filters and deliver comprehensive protection. And for long-term off-grid or family use, the <strong>LifeStraw Family 1.0</strong> gravity purifier provides 18,000 liters of virus-free water with zero electricity at a remarkably reasonable price point.</p>
    {publishedProducts[0] && (
      <a href={getAffiliateUrl(publishedProducts[0].asin)} target="_blank" rel="nofollow sponsored noopener" class="btn-primary" style="color:#fff!important;text-shadow:0 1px 2px rgba(0,0,0,.2)">
        <span>Check Top Pick on Amazon</span>
      </a>
    )}
  </div>
</ContentLayout>

<style>
  .product-mini-review {
    padding-bottom: 2rem;
    margin-bottom: 1rem;
    border-bottom: 1px solid hsl(var(--border) / 0.3);
  }

  .product-mini-review:last-of-type {
    border-bottom: none;
  }

  .pros-cons-mini {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin: 1.25rem 0;
    padding: 1.25rem;
    background: hsl(var(--muted));
    border: 1px solid hsl(var(--border));
    border-radius: 0.75rem;
  }

  @media (max-width: 639px) {
    .pros-cons-mini {
      grid-template-columns: 1fr;
      gap: 1rem;
    }
  }

  .pros-mini ul,
  .cons-mini ul {
    list-style: none;
    padding-left: 0;
    margin: 0.5rem 0 0;
  }

  .pros-mini li {
    color: hsl(150 60% 50%);
    font-size: 0.9375rem;
    margin-bottom: 0.375rem;
    padding-left: 0;
  }

  .cons-mini li {
    color: hsl(0 60% 60%);
    font-size: 0.9375rem;
    margin-bottom: 0.375rem;
    padding-left: 0;
  }

  .pros-mini strong,
  .cons-mini strong {
    font-size: 0.8125rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .review-links {
    font-weight: 600;
  }

  .verdict-card {
    margin-top: 2rem;
    padding: 2rem;
    background: linear-gradient(135deg, hsl(var(--primary) / 0.06), hsl(var(--accent) / 0.04));
    border: 1px solid hsl(var(--primary) / 0.15);
    border-radius: 1rem;
    border-top: 3px solid hsl(var(--primary));
  }

  .verdict-card p {
    margin-bottom: 1.5rem;
    font-size: 1.0625rem;
    line-height: 1.7;
    color: hsl(var(--foreground) / 0.85);
  }

  .btn-primary {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem 1.75rem;
    background: linear-gradient(135deg, hsl(var(--primary)), hsl(var(--primary-warm)));
    color: #fff !important;
    font-weight: 700;
    font-size: 1rem;
    border-radius: 0.75rem;
    text-decoration: none;
    box-shadow: 0 4px 14px -2px hsl(var(--primary) / 0.35);
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px -2px hsl(var(--primary) / 0.45);
  }
</style>
