---
import ContentLayout from '../../layouts/ContentLayout.astro';
import ProductHero from '../../components/ProductHero.astro';
import ProTip from '../../components/ProTip.astro';
import { getProductBySlug, getAffiliateUrl, getRelatedProducts, isPublished, categories, getPriceTier } from '../../lib/config';
import { generateProductSchema, generateFAQSchema, generateArticleSchema, combineSchemas } from '../../lib/schema';

const product = getProductBySlug('waterdrop-g3p600')!;
if (!isPublished(product.publishDate)) return Astro.redirect('/404');

const relatedProducts = getRelatedProducts(product);
const category = categories.find(c => c.slug === product.category);

const faqs = [
  { question: 'Does the Waterdrop G3P600 need a water tank under the sink?', answer: 'No, and that is the primary advantage. The G3P600 is a tankless system that purifies water on demand at 600 GPD (gallons per day). The water flows directly from your supply line through the filters and out the faucet in real time. This eliminates the large pressurized tank that traditional RO systems require, freeing up significant under-sink cabinet space for storage.' },
  { question: 'Does the Waterdrop G3P600 require electricity?', answer: 'Yes. The tankless design uses an internal booster pump to push water through the RO membrane at high pressure, and this pump requires a standard electrical outlet under the sink. If you do not have an outlet under your sink, you will need to have one installed by an electrician before setting up the system. This is the main installation requirement that tank-based systems like the iSpring RCC7AK do not have.' },
  { question: 'What does the smart LED faucet on the Waterdrop G3P600 show?', answer: 'The included smart faucet has a built-in LED display that shows real-time TDS (total dissolved solids) readings of the filtered water. The display changes color based on water quality: blue indicates excellent quality (low TDS), while other colors signal that filter replacement may be needed. It gives you objective, measurable confirmation that your system is working properly without needing a separate TDS meter.' },
  { question: 'How does the Waterdrop G3P600 compare to the iSpring RCC7AK?', answer: 'Both produce excellent RO water with similar TDS reduction (93-98%). The G3P600 costs $429 vs $199 for the iSpring, but offers 8x faster production (600 GPD vs 75 GPD), no tank, a smart TDS faucet, and better water efficiency (2:1 vs 1:3 pure-to-drain). Choose the iSpring if budget is the priority. Choose the Waterdrop if you value speed, space savings, and water efficiency.' },
];

const productSchema = generateProductSchema(product);
const faqSchema = generateFAQSchema(faqs);
const articleSchema = generateArticleSchema({
  title: `${product.name} Review`,
  description: product.verdict,
  url: `/reviews/${product.slug}/`,
  datePublished: product.publishDate,
  dateModified: product.publishDate,
  about: [{ name: product.name, url: `https://www.amazon.com/dp/${product.asin}`, type: 'Product' }],
  mentions: relatedProducts.slice(0, 3).map(p => ({ name: p.name, url: `https://www.amazon.com/dp/${p.asin}`, type: 'Product' })),
});
const schema = combineSchemas(productSchema, faqSchema, articleSchema);

const relatedArticles = [
  ...relatedProducts.slice(0, 2).map(p => ({
    title: `${p.name} Review`,
    url: `/reviews/${p.slug}/`,
    description: p.verdict,
  })),
  ...(category ? [{
    title: `Best ${category.name}`,
    url: `/best-${category.slug}/`,
    description: category.description,
  }] : []),
  {
    title: 'What Is Reverse Osmosis?',
    url: '/what-is-reverse-osmosis/',
    description: 'A complete guide to reverse osmosis technology — how it works, what it removes, and who needs it.',
  },
];
---

<ContentLayout
  title={`${product.shortName} Review ${new Date().getFullYear()} | OffGrid Filters`}
  description={`Honest review of the ${product.name}. ${product.bestFor}.`}
  canonical={`/reviews/${product.slug}/`}
  category="Reviews"
  currentPage={product.name}
  schema={schema}
  relatedArticles={relatedArticles}
  lastUpdated={product.publishDate}
  heroImage={`/assets/${product.slug}-hero.webp`}
>
  <!-- HERO -->
  <h1>{product.name} Review {new Date().getFullYear()}</h1>
  <ProductHero product={product} />

  <!-- OVERVIEW -->
  <h2>Overview</h2>
  <p>The Waterdrop G3P600 represents the modern evolution of residential reverse osmosis. By eliminating the pressurized storage tank that has defined RO systems for decades, Waterdrop has created a system that delivers purified water on demand at 600 gallons per day — 8 times faster than traditional 75 GPD tank systems — while taking up roughly half the under-sink space. At $429, it sits at the premium end of residential RO, but the combination of speed, space efficiency, and smart monitoring features makes a compelling case for the upgrade.</p>
  <p>The 8-stage filtration process runs water through polypropylene pre-filtration, carbon treatment stages, the high-capacity RO membrane, and post-carbon polishing. The 2:1 pure-to-drain ratio is significantly more water-efficient than the 1:3 ratio typical of tank-based systems, which means less water wasted and lower environmental impact. Over the course of a year, a household producing 3 gallons of RO water daily saves roughly 1,600 gallons of water compared to a traditional 1:3 system.</p>
  <p>The smart LED faucet is a feature that sounds gimmicky but proves genuinely useful in practice. The real-time TDS reading gives you objective confirmation that your filters are working, and the color-coded display makes it immediately obvious when performance is degrading. It eliminates the common RO anxiety of "is my system still filtering properly?" and replaces it with a number you can verify at a glance every time you fill a glass.</p>

  <div class="best-for-box">
    <strong>Best For:</strong> {product.bestFor}
  </div>

  <!-- KEY FEATURES -->
  <h2>Key Features &amp; Specifications</h2>
  <table class="specs-table">
    <tr><td><strong>Filtration Stages</strong></td><td>{product.specs.filtrationStages}</td></tr>
    <tr><td><strong>Technology</strong></td><td>{product.specs.filtrationTechnology}</td></tr>
    <tr><td><strong>Micron Rating</strong></td><td>{product.specs.micronRating} microns</td></tr>
    <tr><td><strong>Production Rate</strong></td><td>{product.specs.gpd} GPD</td></tr>
    <tr><td><strong>Pure-to-Drain Ratio</strong></td><td>{product.specs.pureToWaste}</td></tr>
    <tr><td><strong>Certifications</strong></td><td>{product.specs.certifications}</td></tr>
    <tr><td><strong>Dimensions</strong></td><td>{product.specs.dimensions}</td></tr>
    <tr><td><strong>Weight</strong></td><td>{product.specs.weight}</td></tr>
    <tr><td><strong>Filter Life</strong></td><td>{product.specs.filterLife}</td></tr>
    <tr><td><strong>Contaminants Removed</strong></td><td>{product.specs.contaminantsRemoved}</td></tr>
  </table>

  <p>The NSF 42/53/58/372 quad certification is the most comprehensive in our under-sink category. NSF 58 covers the RO membrane performance, while 42 and 53 address chlorine and health-related contaminants. NSF 372 certifies lead-free materials in the system construction itself. The consolidated filter design uses only 3 replacement cartridges (CF, MRO, and CB) on staggered schedules, which simplifies maintenance compared to the 5 separate cartridges in traditional RO systems.</p>

  <ProTip>The G3P600 requires an electrical outlet under the sink for the booster pump. Before purchasing, verify that you have an outlet available or budget $100-200 for an electrician to add one. GFCI-protected outlets are required by code in most jurisdictions for under-sink installations. Also check that your water pressure is at least 14.5 PSI — the system needs minimum pressure to function, though the built-in pump handles most residential water supplies without issue.</ProTip>

  <!-- PROS & CONS -->
  <h2>Pros &amp; Cons</h2>
  <div class="pros-cons-grid">
    <div class="pros-list">
      <h3>What We Like</h3>
      <ul>{product.pros.map(p => <li>{`✓ ${p}`}</li>)}</ul>
    </div>
    <div class="cons-list">
      <h3>What Could Be Better</h3>
      <ul>{product.cons.map(c => <li>{`✗ ${c}`}</li>)}</ul>
    </div>
  </div>

  <!-- PERFORMANCE -->
  <h2>Performance &amp; Real-World Testing</h2>
  <p>The G3P600's on-demand delivery is transformative compared to tank-based systems. Turn on the faucet and water flows immediately at strong, consistent pressure — no waiting for a tank to refill, no pressure drop as the tank empties. With 320 TDS source water, the system consistently produced 12-22 TDS output, representing a 93-96% reduction. The smart faucet displayed these readings in real time with a reassuring blue glow. Taste was excellent — crisp and clean with the neutral character typical of well-processed RO water.</p>
  <p>The booster pump does produce noticeable sound during operation — a steady hum that is audible from the kitchen but not intrusive enough to interrupt conversation. It is louder than a silent tank-based system (where filtration happens passively) but quieter than a dishwasher or garbage disposal. The pump runs only when the faucet is open and shuts off immediately when you close it. After 6,500+ Amazon reviews and a 4.5-star average, the most consistent praise focuses on the space savings and the TDS faucet, while the most common critique is the pump noise and the proprietary filter costs.</p>

  <!-- VALUE ANALYSIS -->
  <h2>Value Analysis</h2>
  <p>At $429, the Waterdrop G3P600 costs more than double the iSpring RCC7AK ($199). The question is whether the premium features justify the gap. The tankless design saves approximately 12 x 12 inches of under-sink floor space — a significant difference in tight cabinets. The 600 GPD flow rate means you never wait for water. The 2:1 water efficiency saves roughly 1,600 gallons of drain water per year. And the smart faucet provides ongoing peace of mind. Replacement filters run about $80-100 annually, roughly $20-30 more than the iSpring, but fewer individual cartridges to manage.</p>
  <p>The 3-year total cost of ownership (system plus filters) comes to approximately $650-730, working out to roughly $0.12-0.15 per gallon of purified water. That is higher than the iSpring's $0.08-0.10 but still dramatically cheaper than bottled water. The Waterdrop G3P600 makes the most sense for households where cabinet space is limited, water efficiency matters, or you simply want the most modern, feature-rich RO experience available. If your priorities are pure value and you have the cabinet space, the iSpring remains the smarter financial choice.</p>

  <!-- FAQ -->
  <h2>Frequently Asked Questions</h2>
  <div class="faq-section">
    {faqs.map(faq => (
      <details class="faq-item">
        <summary>{faq.question}</summary>
        <div class="faq-answer">{faq.answer}</div>
      </details>
    ))}
  </div>

  <!-- VERDICT & CTA -->
  <h2>Final Verdict</h2>
  <div class="verdict-card">    <p>{product.verdict}</p>
    <a href={getAffiliateUrl(product.asin)} target="_blank" rel="nofollow sponsored noopener" class="btn-primary" style="color: #fff !important; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">
      <span>Check Price on Amazon</span>
    </a>
  </div>

  <p style="text-align:center; margin-top:1rem;">
    <a href={`/best-${product.category}/`}>See all {category?.name} reviews &rarr;</a>
  </p>
</ContentLayout>

<style>
  .best-for-box { padding: 1rem 1.25rem; background: hsl(var(--primary) / 0.06); border: 1px solid hsl(var(--primary) / 0.15); border-radius: 0.75rem; margin: 1.5rem 0; font-size: 0.9375rem; color: hsl(var(--foreground)); }
  .pros-cons-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin: 1.5rem 0; }
  @media (min-width: 768px) { .pros-cons-grid { grid-template-columns: 1fr 1fr; } }
  .pros-list, .cons-list { padding: 1.25rem; border-radius: 0.75rem; border: 1px solid hsl(var(--border)); }
  .pros-list { background: hsl(142 70% 45% / 0.04); border-color: hsl(142 70% 45% / 0.15); }
  .cons-list { background: hsl(0 70% 45% / 0.04); border-color: hsl(0 70% 45% / 0.15); }
  .pros-list h3 { color: hsl(142 70% 45%); font-size: 0.875rem; margin-bottom: 0.75rem; margin-top: 0; }
  .cons-list h3 { color: hsl(0 70% 62%); font-size: 0.875rem; margin-bottom: 0.75rem; margin-top: 0; }
  .pros-list ul, .cons-list ul { list-style: none; padding: 0; margin: 0; }
  .pros-list li, .cons-list li { padding: 0.375rem 0; font-size: 0.9375rem; }
  .verdict-card { text-align: center; padding: 2rem; background: hsl(var(--muted) / 0.3); border: 1px solid hsl(var(--border)); border-radius: 1rem; margin: 1.5rem 0; position: relative; overflow: hidden; }
  .verdict-card::before { content: ''; position: absolute; top: 0; left: 0; width: 200%; height: 3px; background: linear-gradient(90deg, hsl(var(--primary)), hsl(var(--accent)), hsl(var(--primary))); animation: gradient-slide 4s linear infinite; will-change: transform; }
  @keyframes gradient-slide { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
  .specs-table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
  .specs-table td { padding: 0.75rem 1rem; border-bottom: 1px solid hsl(var(--border) / 0.5); font-size: 0.9375rem; color: hsl(var(--muted-foreground)); }
  .specs-table td:first-child { width: 40%; color: hsl(var(--foreground)); }
</style>
