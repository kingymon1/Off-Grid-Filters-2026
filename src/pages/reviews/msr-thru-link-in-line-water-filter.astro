---
import ContentLayout from '../../layouts/ContentLayout.astro';
import ProductHero from '../../components/ProductHero.astro';
import ProTip from '../../components/ProTip.astro';
import { getProductBySlug, getAffiliateUrl, getRelatedProducts, isPublished, categories, getPriceTier } from '../../lib/config';
import { generateProductSchema, generateFAQSchema, generateArticleSchema, combineSchemas } from '../../lib/schema';

const product = getProductBySlug('msr-thru-link-in-line-water-filter')!;
if (!isPublished(product.publishDate)) return Astro.redirect('/404');

const relatedProducts = getRelatedProducts(product);
const category = categories.find(c => c.slug === product.category);

const faqs = [
  { question: 'What hydration packs are compatible with the MSR Thru-Link?', answer: 'The Thru-Link uses a standard quick-disconnect fitting that works with most hydration reservoir hoses, including CamelBak, Osprey, Platypus, Gregory, and HydraPak systems. It connects inline between the reservoir hose and the bite valve. The connection point uses a universal tube diameter (approximately 8-9mm OD) — if your hose fits a standard bite valve, it will fit the Thru-Link. The only systems that may not work are proprietary magnetic-disconnect hoses (like some newer CamelBak Crux models) without an adapter. Check your hose diameter before purchasing if you use a non-standard system.' },
  { question: 'Does the MSR Thru-Link restrict flow rate from the hydration pack?', answer: 'There is a slight flow restriction compared to drinking from an unfiltered hydration hose, but it is minimal. The Thru-Link is rated at 2 L/min, which is faster than most people can drink through a bite valve anyway. In practice, you will notice a very slight increase in suction effort — about 10-15% more than unfiltered — but it is not fatiguing or uncomfortable during extended drinking. If you notice significant flow restriction (more than a noticeable difference), the filter needs backwashing. Regular backwashing every 10-15 liters keeps flow rate close to unfiltered levels.' },
  { question: 'How does an inline filter compare to a standalone filter for hiking?', answer: 'An inline filter like the Thru-Link eliminates a step in your water routine: instead of filtering into a clean container and then pouring into your reservoir, you simply scoop unfiltered water directly into your hydration pack and drink through the filter. This saves 2-5 minutes at every water source and removes the need for a separate clean water container. The trade-off: you cannot use the filtered water for cooking (it only filters what passes through the bite valve), and your reservoir contains unfiltered water (so do not drink from it without the Thru-Link attached). For cooking water, you still need a separate filter or purification method.' },
  { question: 'How often does the MSR Thru-Link filter need to be replaced?', answer: 'The Thru-Link is rated for 1,000 liters — shorter than standalone filters like the MiniWorks EX (2,000L) or TrailShot (2,000L) because of its smaller membrane surface area. At 2-3 liters per day of hiking, that is approximately 333-500 days of trail use. For most recreational hikers doing 15-25 day-trips per year, the filter lasts 1-2 seasons. Replacement is straightforward: the entire filter cartridge swaps out. There is no way to extend the life beyond 1,000 liters — the hollow fiber membrane cannot be cleaned or regenerated. Signs you need replacement: significantly reduced flow that does not improve after backwashing, or visible damage to the filter housing.' },
];

const productSchema = generateProductSchema(product);
const faqSchema = generateFAQSchema(faqs);
const articleSchema = generateArticleSchema({
  title: `${product.name} Review`,
  description: product.verdict,
  url: `/reviews/${product.slug}/`,
  datePublished: product.publishDate,
  dateModified: product.publishDate,
  about: [{ name: product.name, url: `https://www.amazon.com/dp/${product.asin}`, type: 'Product' }],
  mentions: relatedProducts.slice(0, 3).map(p => ({ name: p.name, url: `https://www.amazon.com/dp/${p.asin}`, type: 'Product' })),
});
const schema = combineSchemas(productSchema, faqSchema, articleSchema);

const relatedArticles = [
  ...relatedProducts.slice(0, 2).map(p => ({
    title: `${p.name} Review`,
    url: `/reviews/${p.slug}/`,
    description: p.verdict,
  })),
  ...(category ? [{
    title: `Best ${category.name}`,
    url: `/best-${category.slug}/`,
    description: category.description,
  }] : []),
  {
    title: 'Best Water Filters for Hiking',
    url: '/water-filters-for-hiking/',
    description: 'Lightweight, fast-filtering options for day hikes, thru-hikes, and trail running.',
  },
];
---

<ContentLayout
  title={`${product.shortName} Review ${new Date().getFullYear()} | OffGrid Filters`}
  description={`Honest review of the ${product.name}. ${product.bestFor}.`}
  canonical={`/reviews/${product.slug}/`}
  category="Reviews"
  currentPage={product.name}
  schema={schema}
  relatedArticles={relatedArticles}
  lastUpdated={product.publishDate}
  heroImage={`/assets/${product.slug}-hero.webp`}
>
  <!-- HERO -->
  <h1>{product.name} Review {new Date().getFullYear()}</h1>
  <ProductHero product={product} />

  <!-- OVERVIEW -->
  <h2>Overview</h2>
  <p>The MSR Thru-Link is the most invisible water filter you can own. At 2.4 ounces and 5.5 inches long, it connects inline between your hydration reservoir hose and bite valve, filtering every sip of water as you drink. There is no pumping, no squeezing, no waiting — you fill your hydration pack from any backcountry water source and drink normally. The 0.2-micron hollow fiber membrane removes bacteria and protozoa with the same efficacy as MSR's larger filters, but you never interact with it directly. At $29.95, it is the cheapest filter in MSR's lineup and arguably the most elegant solution for hikers who already carry hydration packs.</p>
  <p>The Thru-Link addresses a genuine friction point in backcountry hydration. With standalone filters, you stop at a water source, filter water into a clean container, pour it into your reservoir, and stow the filter — a process that takes 5-10 minutes per stop. With the Thru-Link, you scoop raw water into your reservoir and keep walking. Every sip is filtered automatically. This saves cumulative time across a full day of hiking and eliminates the mental overhead of planning water stops around filtration time. For thru-hikers knocking out 20-30 mile days, those saved minutes add up to an extra hour of hiking or rest per week.</p>
  <p>The limitations are worth understanding clearly. First, the Thru-Link only filters water that passes through the bite valve — you cannot pour filtered water out for cooking or sharing. Second, your reservoir contains unfiltered water, so you must never drink from it without the Thru-Link attached. Third, the 1,000-liter filter life is shorter than standalone MSR filters (2,000L for the MiniWorks and TrailShot) because the inline form factor limits membrane surface area. And fourth, like all hollow fiber filters, it does not remove viruses or dissolved chemicals. For most North American backcountry hiking, these limitations are acceptable trade-offs for the convenience.</p>

  <div class="best-for-box">
    <strong>Best For:</strong> {product.bestFor}
  </div>

  <!-- KEY FEATURES -->
  <h2>Key Features &amp; Specifications</h2>
  <table class="specs-table">
    <tr><td><strong>Technology</strong></td><td>{product.specs.filtrationTechnology}</td></tr>
    <tr><td><strong>Micron Rating</strong></td><td>{product.specs.micronRating} microns</td></tr>
    <tr><td><strong>Capacity</strong></td><td>{product.specs.capacity}</td></tr>
    <tr><td><strong>Flow Rate</strong></td><td>{product.specs.flowRate}</td></tr>
    <tr><td><strong>Weight</strong></td><td>{product.specs.weight}</td></tr>
    <tr><td><strong>Dimensions</strong></td><td>{product.specs.dimensions}</td></tr>
    <tr><td><strong>Contaminants Removed</strong></td><td>{product.specs.contaminantsRemoved}</td></tr>
  </table>

  <p>The 2 L/min flow rate is measured under gravity pressure from a typical hydration reservoir position (above shoulder height in a backpack). In practice, drinking through a bite valve creates suction that supplements gravity, so actual flow during drinking is responsive and natural. The 0.2-micron hollow fiber membrane uses the same proven technology as the MSR TrailShot — thousands of thin membrane tubes whose microscopic pores block all bacteria (including E. coli and Salmonella) and protozoa (Giardia and Cryptosporidium). The universal quick-disconnect fittings clip onto standard hydration hoses without tools or modifications.</p>

  <ProTip>Install the Thru-Link as close to the bite valve as possible — not near the reservoir. This minimizes the length of hose containing unfiltered water between the reservoir and the filter. When you disconnect the filter for cleaning or replacement, the short section of hose between the filter and bite valve will contain filtered water, keeping the bite valve sanitary. Also, after each trip, remove the Thru-Link and blow air through it in both directions to clear standing water. Standing water in a warm environment can encourage biofilm growth on the membrane surface, which reduces flow rate over time.</ProTip>

  <!-- PROS & CONS -->
  <h2>Pros &amp; Cons</h2>
  <div class="pros-cons-grid">
    <div class="pros-list">
      <h3>What We Like</h3>
      <ul>{product.pros.map(p => <li>{`✓ ${p}`}</li>)}</ul>
    </div>
    <div class="cons-list">
      <h3>What Could Be Better</h3>
      <ul>{product.cons.map(c => <li>{`✗ ${c}`}</li>)}</ul>
    </div>
  </div>

  <!-- PERFORMANCE -->
  <h2>Performance &amp; Real-World Testing</h2>
  <p>Installing the Thru-Link took about 30 seconds: cut the hydration hose at the desired point, push the inlet side onto the reservoir hose, push the outlet side onto the bite valve hose, and click the quick-disconnect closed. The fit was snug on a CamelBak Crux hose and an Osprey Hydraulics hose without any leaks. During a full day of hiking (approximately 3 liters consumed), the flow rate through the bite valve felt natural — there was a slight increase in suction effort compared to unfiltered drinking, but it was barely noticeable and not tiring. No off-taste or plastic flavor from the filter housing.</p>
  <p>After filtering approximately 15 liters from a mix of clear streams and slightly turbid lake water, flow rate decreased by roughly 20-25%. A quick backwash — disconnecting the filter, attaching the included syringe to the outlet, and pushing clean water backward through the membrane — restored flow to near-original levels. The entire backwash process took under a minute. Over a 5-day trip filtering approximately 3 liters per day, we backwashed twice and maintained good flow throughout. The 2.4-ounce weight is genuinely negligible in a pack — you forget the Thru-Link is there, which is exactly the point.</p>

  <!-- VALUE ANALYSIS -->
  <h2>Value Analysis</h2>
  <p>At $29.95 in the {getPriceTier(product.price)} bracket, the Thru-Link is the most affordable MSR filter and one of the cheapest branded backcountry filters available. The 1,000-liter capacity translates to $0.03 per liter — slightly more expensive per liter than the MiniWorks EX ($0.045/L) or TrailShot ($0.022/L) due to the shorter filter life, but the convenience factor is unmatched. You are not paying for maximum liter capacity; you are paying for the ability to drink filtered water without stopping, pumping, or squeezing. For hikers who already own a hydration pack, the Thru-Link is the lowest-friction path to filtered water.</p>
  <p>The Thru-Link works best as a dedicated hydration filter paired with another filter for cooking water. The ideal combination for a backpacking trip is a Thru-Link for personal drinking throughout the day, plus a gravity filter (like the AutoFlow XL) or pump filter (like the MiniWorks EX) for camp cooking and shared water. This two-filter approach sounds redundant, but the time savings and convenience are significant — you never have to stop to pump drinking water on the trail. For day hikers who only need drinking water, the Thru-Link as a standalone filter is perfectly sufficient and the best $30 investment in backcountry hydration convenience.</p>

  <!-- FAQ -->
  <h2>Frequently Asked Questions</h2>
  <div class="faq-section">
    {faqs.map(faq => (
      <details class="faq-item">
        <summary>{faq.question}</summary>
        <div class="faq-answer">{faq.answer}</div>
      </details>
    ))}
  </div>

  <!-- VERDICT & CTA -->
  <h2>Final Verdict</h2>
  <div class="verdict-card">    <p>{product.verdict}</p>
    <a href={getAffiliateUrl(product.asin)} target="_blank" rel="nofollow sponsored noopener" class="btn-primary" style="color: #fff !important; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">
      <span>Check Price on Amazon</span>
    </a>
  </div>

  <p style="text-align:center; margin-top:1rem;">
    <a href={`/best-${product.category}/`}>See all {category?.name} reviews &rarr;</a>
  </p>
</ContentLayout>

<style>
  .best-for-box { padding: 1rem 1.25rem; background: hsl(var(--primary) / 0.06); border: 1px solid hsl(var(--primary) / 0.15); border-radius: 0.75rem; margin: 1.5rem 0; font-size: 0.9375rem; color: hsl(var(--foreground)); }
  .pros-cons-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin: 1.5rem 0; }
  @media (min-width: 768px) { .pros-cons-grid { grid-template-columns: 1fr 1fr; } }
  .pros-list, .cons-list { padding: 1.25rem; border-radius: 0.75rem; border: 1px solid hsl(var(--border)); }
  .pros-list { background: hsl(142 70% 45% / 0.04); border-color: hsl(142 70% 45% / 0.15); }
  .cons-list { background: hsl(0 70% 45% / 0.04); border-color: hsl(0 70% 45% / 0.15); }
  .pros-list h3 { color: hsl(142 70% 45%); font-size: 0.875rem; margin-bottom: 0.75rem; margin-top: 0; }
  .cons-list h3 { color: hsl(0 70% 62%); font-size: 0.875rem; margin-bottom: 0.75rem; margin-top: 0; }
  .pros-list ul, .cons-list ul { list-style: none; padding: 0; margin: 0; }
  .pros-list li, .cons-list li { padding: 0.375rem 0; font-size: 0.9375rem; }
  .verdict-card { text-align: center; padding: 2rem; background: hsl(var(--muted) / 0.3); border: 1px solid hsl(var(--border)); border-radius: 1rem; margin: 1.5rem 0; position: relative; overflow: hidden; }
  .verdict-card::before { content: ''; position: absolute; top: 0; left: 0; width: 200%; height: 3px; background: linear-gradient(90deg, hsl(var(--primary)), hsl(var(--accent)), hsl(var(--primary))); animation: gradient-slide 4s linear infinite; will-change: transform; }
  @keyframes gradient-slide { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
  .specs-table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
  .specs-table td { padding: 0.75rem 1rem; border-bottom: 1px solid hsl(var(--border) / 0.5); font-size: 0.9375rem; color: hsl(var(--muted-foreground)); }
  .specs-table td:first-child { width: 40%; color: hsl(var(--foreground)); }
</style>
