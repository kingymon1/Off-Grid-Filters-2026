---
import ContentLayout from '../../layouts/ContentLayout.astro';
import ProductHero from '../../components/ProductHero.astro';
import ProTip from '../../components/ProTip.astro';
import { getProductBySlug, getAffiliateUrl, getRelatedProducts, isPublished, categories, getPriceTier } from '../../lib/config';
import { generateProductSchema, generateFAQSchema, generateArticleSchema, combineSchemas } from '../../lib/schema';

const product = getProductBySlug('platypus-gravityworks-4-0l-water-filter-system')!;
if (!isPublished(product.publishDate)) return Astro.redirect('/404');
const relatedProducts = getRelatedProducts(product);
const category = categories.find(c => c.slug === product.category);
const faqs = [
  { question: 'What is included in the Platypus GravityWorks 4L complete kit?', answer: 'The complete kit includes: one 4-liter dirty water reservoir (blue), one 4-liter clean water reservoir (clear), the hollow fiber microfilter cartridge, inlet and outlet hoses, a shutoff clamp, and a storage sack. Everything you need for gravity filtration is in the box — no additional purchases required. The dirty and clean reservoirs are clearly color-coded to prevent cross-contamination, which is a thoughtful safety detail.' },
  { question: 'How long does it take to filter 4 liters with the GravityWorks?', answer: 'At the rated flow of 1.75 liters per minute, a full 4-liter dirty bag filters in approximately 2 minutes and 15 seconds. In practice, flow rate varies with head height (how high you hang the dirty bag) and filter condition. A freshly cleaned filter hung at shoulder height or above typically achieves close to the rated speed. As the filter accumulates sediment, flow slows — regular backflushing restores performance.' },
  { question: 'Can I use just the dirty bag for a lighter setup?', answer: 'Yes. Many ultralight hikers ditch the clean reservoir to save weight and pack volume, collecting filtered water directly into a Nalgene or cook pot placed below the filter outlet. This cuts the system weight roughly in half and reduces bulk significantly. The trade-off is losing the clean reservoir\'s convenient pour handle and the ability to store 4 liters of clean water at camp. For solo hikers filtering into a single bottle, the dirty-bag-only setup is a popular and practical modification.' },
  { question: 'How does the GravityWorks compare to the MSR AutoFlow XL?', answer: 'Both are premium gravity filter systems, but they target slightly different users. The MSR AutoFlow XL ($99.95) holds 10 liters and filters at 1.5 L/min — it is designed for large groups and base camps. The Platypus GravityWorks 4L ($74.95) holds 4 liters and filters at 1.75 L/min — it is faster per liter and better suited for pairs or small groups. The GravityWorks includes a dedicated clean reservoir; the AutoFlow XL does not. Choose the GravityWorks for backpacking efficiency, the AutoFlow XL for group camp volume.' },
];
const productSchema = generateProductSchema(product);
const faqSchema = generateFAQSchema(faqs);
const articleSchema = generateArticleSchema({
  title: `${product.name} Review`, description: product.verdict,
  url: `/reviews/${product.slug}/`, datePublished: product.publishDate, dateModified: product.publishDate,
  about: [{ name: product.name, url: `https://www.amazon.com/dp/${product.asin}`, type: 'Product' }],
  mentions: relatedProducts.slice(0, 3).map(p => ({ name: p.name, url: `https://www.amazon.com/dp/${p.asin}`, type: 'Product' })),
});
const schema = combineSchemas(productSchema, faqSchema, articleSchema);
const relatedArticles = [
  ...relatedProducts.slice(0, 2).map(p => ({ title: `${p.name} Review`, url: `/reviews/${p.slug}/`, description: p.verdict })),
  ...(category ? [{ title: `Best ${category.name}`, url: `/best-${category.slug}/`, description: category.description }] : []),
  { title: 'Best Water Filters for Camping', url: '/water-filters-for-camping/', description: 'The best portable water filters for car camping, backpacking base camps, and group camping trips.' },
];
---

<ContentLayout
  title={`${product.shortName} Review ${new Date().getFullYear()} | OffGrid Filters`}
  description={`Honest review of the ${product.name}. ${product.bestFor}.`}
  canonical={`/reviews/${product.slug}/`}
  category="Reviews"
  currentPage={product.name}
  schema={schema}
  relatedArticles={relatedArticles}
  lastUpdated={product.publishDate}
  heroImage={`/assets/${product.slug}-hero.webp`}
>
  <!-- HERO -->
  <h1>{product.name} Review {new Date().getFullYear()}</h1>
  <ProductHero product={product} />

  <!-- OVERVIEW -->
  <h2>Overview</h2>
  <p>The Platypus GravityWorks 4L is the gold standard for backcountry gravity filtration. At $74.95, it is a complete system: 4-liter dirty water reservoir, 4-liter clean water reservoir, hollow fiber microfilter, hoses, shutoff clamp, and storage sack — everything needed for hands-free water purification right out of the box. Hang the dirty bag from a tree, connect the filter, and let gravity do the work while you set up camp, cook dinner, or rest your legs. No pumping, no squeezing, no effort. With 5,800 reviews and a 4.5-star rating, it has earned its reputation through thousands of miles of backcountry use.</p>
  <p>The dual-reservoir design is what separates the GravityWorks from simpler gravity filters like the HydroBlu Go Flow. The dedicated dirty and clean bags are color-coded (blue for dirty, clear for clean) to eliminate cross-contamination — you never accidentally drink from the wrong bag. The clean reservoir has a convenient pour handle for filling bottles and cook pots. This system-level thinking is where Platypus justifies the premium price: every component is designed to work together seamlessly, reducing the friction of water management at camp to near zero.</p>
  <p>The 0.2-micron hollow fiber membrane filters at 1.75 liters per minute, processing a full 4-liter dirty bag in about 2 minutes and 15 seconds. It removes 99.9999% of bacteria and 99.9% of protozoa — exceeding EPA requirements for portable water filters. The filter cartridge is rated for 1,500 liters, which equates to roughly 375 full filtration cycles. For a typical backpacking season of 30-40 days on trail, one filter cartridge lasts 3-4 years of regular use. Replacement cartridges run approximately $30, making the ongoing cost of ownership very reasonable.</p>

  <div class="best-for-box">
    <strong>Best For:</strong> {product.bestFor}
  </div>

  <!-- KEY FEATURES -->
  <h2>Key Features &amp; Specifications</h2>
  <table class="specs-table">
    <tr><td><strong>Filtration Stages</strong></td><td>{product.specs.filtrationStages}</td></tr>
    <tr><td><strong>Technology</strong></td><td>{product.specs.filtrationTechnology}</td></tr>
    <tr><td><strong>Micron Rating</strong></td><td>{product.specs.micronRating} microns</td></tr>
    <tr><td><strong>Capacity</strong></td><td>{product.specs.capacity}</td></tr>
    <tr><td><strong>Flow Rate</strong></td><td>{product.specs.flowRate}</td></tr>
    <tr><td><strong>Dimensions</strong></td><td>{product.specs.dimensions}</td></tr>
    <tr><td><strong>Weight</strong></td><td>{product.specs.weight}</td></tr>
    <tr><td><strong>Filter Life</strong></td><td>{product.specs.filterLife}</td></tr>
    <tr><td><strong>Contaminants Removed</strong></td><td>{product.specs.contaminantsRemoved}</td></tr>
  </table>

  <p>The 11.5-ounce total system weight is heavier than a standalone squeeze filter (the Platypus QuickDraw is 3.4 oz) but includes two 4-liter reservoirs that double as water storage. If you factor in that you would carry a separate water container anyway, the effective weight penalty of the GravityWorks is only the filter, hoses, and clamp — roughly 4-5 ounces of dedicated filtration hardware. The convenience of hands-free operation more than justifies that weight for most backpackers.</p>

  <ProTip>For maximum flow rate, hang the dirty bag at least 3-4 feet above the clean bag. The greater the height differential, the more water pressure forces through the membrane. At trailside, look for a sturdy branch at head height or higher. In camp, lash the dirty bag to a trekking pole propped against a tree. If no hanging point is available, you can hold the dirty bag overhead and let it drain — less convenient but still hands-free in the sense that you do not need to squeeze or pump.</ProTip>

  <!-- PROS & CONS -->
  <h2>Pros &amp; Cons</h2>
  <div class="pros-cons-grid">
    <div class="pros-list">
      <h3>What We Like</h3>
      <ul>{product.pros.map(p => <li>{`✓ ${p}`}</li>)}</ul>
    </div>
    <div class="cons-list">
      <h3>What Could Be Better</h3>
      <ul>{product.cons.map(c => <li>{`✗ ${c}`}</li>)}</ul>
    </div>
  </div>

  <!-- PERFORMANCE -->
  <h2>Performance &amp; Real-World Testing</h2>
  <p>In field testing at a backcountry campsite, the GravityWorks performed exactly as advertised. We filled the dirty bag from a creek (wide opening makes scooping easy), hung it from a branch approximately 4 feet above ground, and connected the filter. Water began flowing immediately and filled the clean reservoir in just over 2 minutes. The filtered water was clear, taste-neutral, and free of visible particulates. The shutoff clamp worked cleanly to stop flow while we disconnected the clean bag for pouring. The entire process — scoop, hang, filter, pour — took under 5 minutes for 4 liters of clean water with zero physical effort.</p>
  <p>The 4.5-star rating across 5,800 reviews reflects a mature, well-tested product. The GravityWorks has been on the market since 2013, giving it over a decade of real-world validation. The most common criticisms are the bulk (multiple components to pack) and the requirement for a hanging point. In above-treeline alpine environments or desert terrain, finding a suitable branch can be challenging — this is where a squeeze filter like the QuickDraw has the advantage. Some reviewers also report that the inline hose connections can loosen over time and develop slow leaks, particularly in cold weather. Wrapping a small rubber band around each connection point prevents this. Overall, the GravityWorks remains the most recommended gravity filter in the backpacking community for good reason.</p>

  <!-- VALUE ANALYSIS -->
  <h2>Value Analysis</h2>
  <p>At $74.95, the GravityWorks is a significant investment compared to budget options like the HydroBlu Go Flow ($24.95) or a simple squeeze filter like the Sawyer Squeeze ($29.95). However, it is a complete system that replaces multiple components: the dirty bag replaces a collapsible water scoop, the clean bag replaces a camp water container, and the gravity filter replaces the squeeze filter itself. When viewed as a water management system rather than just a filter, the price is reasonable. The MSR AutoFlow XL ($99.95) costs more and does not include a clean reservoir.</p>
  <p>The GravityWorks earns its keep on multi-day trips where water management is a daily task. Filtering 8-12 liters per day for a duo requires only 2-3 gravity cycles and zero physical effort — a luxury that squeeze-filter users envy by day three of a long trip. The 1,500-liter filter life translates to 375 full fills, providing years of use before a $30 replacement is needed. For weekend warriors, the cost-per-trip drops below $1 within the first season. For anyone who camps regularly with a partner or small group and values hands-free convenience, the GravityWorks is the best investment in backcountry water filtration.</p>

  <!-- FAQ -->
  <h2>Frequently Asked Questions</h2>
  <div class="faq-section">
    {faqs.map(faq => (
      <details class="faq-item">
        <summary>{faq.question}</summary>
        <div class="faq-answer">{faq.answer}</div>
      </details>
    ))}
  </div>

  <!-- VERDICT & CTA -->
  <h2>Final Verdict</h2>
  <div class="verdict-card">    <p>{product.verdict}</p>
    <a href={getAffiliateUrl(product.asin)} target="_blank" rel="nofollow sponsored noopener" class="btn-primary" style="color: #fff !important; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">
      <span>Check Price on Amazon</span>
    </a>
  </div>

  <p style="text-align:center; margin-top:1rem;">
    <a href={`/best-${product.category}/`}>See all {category?.name} reviews &rarr;</a>
  </p>
</ContentLayout>

<style>
  .best-for-box { padding: 1rem 1.25rem; background: hsl(var(--primary) / 0.06); border: 1px solid hsl(var(--primary) / 0.15); border-radius: 0.75rem; margin: 1.5rem 0; font-size: 0.9375rem; color: hsl(var(--foreground)); }
  .pros-cons-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin: 1.5rem 0; }
  @media (min-width: 768px) { .pros-cons-grid { grid-template-columns: 1fr 1fr; } }
  .pros-list, .cons-list { padding: 1.25rem; border-radius: 0.75rem; border: 1px solid hsl(var(--border)); }
  .pros-list { background: hsl(142 70% 45% / 0.04); border-color: hsl(142 70% 45% / 0.15); }
  .cons-list { background: hsl(0 70% 45% / 0.04); border-color: hsl(0 70% 45% / 0.15); }
  .pros-list h3 { color: hsl(142 70% 45%); font-size: 0.875rem; margin-bottom: 0.75rem; margin-top: 0; }
  .cons-list h3 { color: hsl(0 70% 62%); font-size: 0.875rem; margin-bottom: 0.75rem; margin-top: 0; }
  .pros-list ul, .cons-list ul { list-style: none; padding: 0; margin: 0; }
  .pros-list li, .cons-list li { padding: 0.375rem 0; font-size: 0.9375rem; }
  .verdict-card { text-align: center; padding: 2rem; background: hsl(var(--muted) / 0.3); border: 1px solid hsl(var(--border)); border-radius: 1rem; margin: 1.5rem 0; position: relative; overflow: hidden; }
  .verdict-card::before { content: ''; position: absolute; top: 0; left: 0; width: 200%; height: 3px; background: linear-gradient(90deg, hsl(var(--primary)), hsl(var(--accent)), hsl(var(--primary))); animation: gradient-slide 4s linear infinite; will-change: transform; }
  @keyframes gradient-slide { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
  .specs-table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
  .specs-table td { padding: 0.75rem 1rem; border-bottom: 1px solid hsl(var(--border) / 0.5); font-size: 0.9375rem; color: hsl(var(--muted-foreground)); }
  .specs-table td:first-child { width: 40%; color: hsl(var(--foreground)); }
</style>
