---
import ContentLayout from '../../layouts/ContentLayout.astro';
import ProductHero from '../../components/ProductHero.astro';
import ProTip from '../../components/ProTip.astro';
import { getProductBySlug, getAffiliateUrl, getRelatedProducts, isPublished, categories, getPriceTier } from '../../lib/config';
import { generateProductSchema, generateFAQSchema, generateArticleSchema, combineSchemas } from '../../lib/schema';

const product = getProductBySlug('msr-aquatabs-30pack')!;
if (!isPublished(product.publishDate)) return Astro.redirect('/404');

const relatedProducts = getRelatedProducts(product);
const category = categories.find(c => c.slug === product.category);

const faqs = [
  { question: 'How long do Aquatabs take to purify water?', answer: 'Aquatabs require 30 minutes of contact time to effectively purify water at standard temperatures (above 59°F / 15°C). In cold water below 50°F, double the contact time to 60 minutes. The tablet dissolves within 5 minutes, but the full 30-minute wait is necessary for the NaDCC to reach effective chlorine concentration and kill all targeted pathogens including Giardia cysts.' },
  { question: 'Do Aquatabs make water taste like chlorine?', answer: 'There is a mild chlorine taste, but it is significantly less noticeable than iodine-based purification tablets. The NaDCC (sodium dichloroisocyanurate) formula produces less residual taste than older chlorine or iodine methods. If the taste bothers you, let the treated water sit open for an additional 15-30 minutes after the treatment period, or pour it between two containers a few times — both methods help dissipate residual chlorine.' },
  { question: 'Can Aquatabs remove sediment, chemicals, or heavy metals from water?', answer: 'No. Aquatabs are purely a biological treatment — they kill viruses, bacteria, and protozoa through chemical disinfection. They do not filter out sediment, remove chemicals, reduce heavy metals, or clear turbid water. For complete water treatment in the field, use a filter straw first (to remove bacteria, protozoa, and sediment), then treat the filtered water with an Aquatab (to kill any viruses the filter missed).' },
  { question: 'How should Aquatabs be stored for emergency preparedness?', answer: 'Store Aquatabs in their original sealed foil packaging in a cool, dry, dark place. Unopened packaging maintains potency for up to 5 years from the manufacture date. Once the foil strip is opened, use the remaining tablets within 12 months. Do not expose tablets to moisture before use, as NaDCC reacts with water. For emergency kits, store multiple sealed strips rather than one opened package.' },
];

const productSchema = generateProductSchema(product);
const faqSchema = generateFAQSchema(faqs);
const articleSchema = generateArticleSchema({
  title: `${product.name} Review`,
  description: product.verdict,
  url: `/reviews/${product.slug}/`,
  datePublished: product.publishDate,
  dateModified: product.publishDate,
  about: [{ name: product.name, url: `https://www.amazon.com/dp/${product.asin}`, type: 'Product' }],
  mentions: relatedProducts.slice(0, 3).map(p => ({ name: p.name, url: `https://www.amazon.com/dp/${p.asin}`, type: 'Product' })),
});
const schema = combineSchemas(productSchema, faqSchema, articleSchema);

const relatedArticles = [
  ...relatedProducts.slice(0, 2).map(p => ({
    title: `${p.name} Review`,
    url: `/reviews/${p.slug}/`,
    description: p.verdict,
  })),
  ...(category ? [{
    title: `Best ${category.name}`,
    url: `/best-${category.slug}/`,
    description: category.description,
  }] : []),
  {
    title: 'Best Water Filters for Emergency Preparedness',
    url: '/water-filters-for-emergencies/',
    description: 'Build a complete water purification kit for natural disasters, power outages, and SHTF scenarios.',
  },
];
---

<ContentLayout
  title={`${product.shortName} Review ${new Date().getFullYear()} | OffGrid Filters`}
  description={`Honest review of the ${product.name}. ${product.bestFor}.`}
  canonical={`/reviews/${product.slug}/`}
  category="Reviews"
  currentPage={product.name}
  schema={schema}
  relatedArticles={relatedArticles}
  lastUpdated={product.publishDate}
  heroImage={`/assets/${product.slug}-hero.webp`}
>
  <!-- HERO -->
  <h1>{product.name} Review {new Date().getFullYear()}</h1>
  <ProductHero product={product} />

  <!-- OVERVIEW -->
  <h2>Overview</h2>
  <p>MSR Aquatabs solve a critical gap that every filter straw leaves open: virus removal. Filter straws with 0.1-micron membranes stop bacteria and protozoa, but viruses (0.02-0.3 microns) pass right through. Aquatabs use NaDCC (sodium dichloroisocyanurate) — a WHO-recommended chemical disinfectant — to kill viruses, bacteria, and Giardia through chlorine-based oxidation. At $11.99 for 30 tablets that treat 60 quarts of water, they weigh virtually nothing and cost approximately $0.40 per tablet or $0.20 per quart of purified water.</p>
  <p>The NaDCC formulation is a meaningful upgrade over older iodine-based purification tablets. Iodine leaves a strong, unpleasant taste, has a shorter shelf life, and is not recommended for pregnant women or people with thyroid conditions. NaDCC produces a milder chlorine flavor that most people find tolerable, and it is safe for virtually all users. The EPA registration and WHO recommendation provide institutional confidence that iodine tablets simply cannot match.</p>
  <p>Aquatabs are not a standalone water purification solution — they do not remove sediment, chemicals, or heavy metals, and they require 30 minutes of contact time. They are designed as a complement to physical filtration. The ideal field water treatment protocol is: pre-filter with a cloth for large debris, filter through a 0.1-micron straw for bacteria and protozoa removal, then treat with an Aquatab for virus kill. This layered approach provides comprehensive protection against all waterborne pathogens.</p>

  <div class="best-for-box">
    <strong>Best For:</strong> {product.bestFor}
  </div>

  <!-- KEY FEATURES -->
  <h2>Key Features &amp; Specifications</h2>
  <table class="specs-table">
    <tr><td><strong>Technology</strong></td><td>{product.specs.filtrationTechnology}</td></tr>
    <tr><td><strong>Capacity</strong></td><td>{product.specs.capacity}</td></tr>
    <tr><td><strong>Certifications</strong></td><td>{product.specs.certifications}</td></tr>
    <tr><td><strong>Weight</strong></td><td>{product.specs.weight}</td></tr>
    <tr><td><strong>Pack Size</strong></td><td>{product.specs.packSize}</td></tr>
    <tr><td><strong>Pathogens Killed</strong></td><td>{product.specs.contaminantsRemoved}</td></tr>
  </table>

  <p>NaDCC works by releasing free chlorine when dissolved in water. The free chlorine oxidizes the cell membranes and DNA of microorganisms, rendering them inactive. The 30-minute contact time allows the chlorine to reach effective concentration throughout the water volume. Each tablet is dosed for 2 quarts (approximately 1 liter) — using more water per tablet reduces the chlorine concentration below effective levels, so always follow the dosing instructions precisely.</p>

  <ProTip>Carry Aquatabs in your first aid kit or the brain of your backpack (top lid pocket) — they are so light you will forget they are there. The best practice is to pair them with a filter straw: filter first to remove bacteria, protozoa, and sediment, then drop an Aquatab into the filtered water for 30 minutes to kill any viruses. This two-step process gives you the most complete water treatment possible in the field without carrying a heavy pump or UV device.</ProTip>

  <!-- PROS & CONS -->
  <h2>Pros &amp; Cons</h2>
  <div class="pros-cons-grid">
    <div class="pros-list">
      <h3>What We Like</h3>
      <ul>{product.pros.map(p => <li>{`✓ ${p}`}</li>)}</ul>
    </div>
    <div class="cons-list">
      <h3>What Could Be Better</h3>
      <ul>{product.cons.map(c => <li>{`✗ ${c}`}</li>)}</ul>
    </div>
  </div>

  <!-- PERFORMANCE -->
  <h2>Performance &amp; Real-World Testing</h2>
  <p>Each tablet dissolved completely within 3-4 minutes in room-temperature water, leaving no residue. The treated water had a mild chlorine taste — noticeable but far less offensive than iodine tablets. After the full 30-minute treatment period, the water was safe for consumption by EPA standards. In cold water (near 40°F from a mountain stream), dissolution took closer to 6-7 minutes and we extended the treatment time to 45 minutes for extra safety. The water appeared unchanged — Aquatabs do not clear turbid water or remove visible particles.</p>
  <p>The 30-pack's compact form factor is a genuine advantage. The entire strip fits in a shirt pocket and weighs 0.5 ounces — less than a single AAA battery. For ultralight hikers and minimalist preppers, this weight-to-capacity ratio is unmatched by any other water purification method. A single pack provides 15 gallons of treated water, enough for one person for 7-10 days at 2 quarts per day. With 5,500 reviews and a 4.6-star rating, MSR Aquatabs are the most trusted chemical purification option on Amazon, backed by MSR's decades of reputation in backcountry water treatment.</p>

  <!-- VALUE ANALYSIS -->
  <h2>Value Analysis</h2>
  <p>At $0.40 per tablet (treating 2 quarts), Aquatabs cost approximately $0.20 per quart of purified water. This is more expensive per volume than filter straws, but the comparison is misleading — Aquatabs and filters serve different purposes. Aquatabs kill viruses; filters remove bacteria and protozoa. For complete water safety, you need both, and the combined cost (a $7-10 filter straw plus a $12 pack of Aquatabs) is still under $25 for a comprehensive water purification system that handles every pathogen category.</p>
  <p>Compared to other chemical purification options, Aquatabs offer excellent value. Katadyn Micropur tablets cost approximately $0.70 per liter treated. Iodine tablets run about $0.30-0.40 per liter but with significant taste and health disadvantages. Aquatabs hit the sweet spot of effectiveness, taste acceptability, and cost. For emergency preparedness specifically, the 5-year sealed shelf life makes Aquatabs the most practical chemical purification method to stockpile — they remain effective long after you buy them, unlike iodine tablets that degrade more quickly.</p>

  <!-- FAQ -->
  <h2>Frequently Asked Questions</h2>
  <div class="faq-section">
    {faqs.map(faq => (
      <details class="faq-item">
        <summary>{faq.question}</summary>
        <div class="faq-answer">{faq.answer}</div>
      </details>
    ))}
  </div>

  <!-- VERDICT & CTA -->
  <h2>Final Verdict</h2>
  <div class="verdict-card">    <p>{product.verdict}</p>
    <a href={getAffiliateUrl(product.asin)} target="_blank" rel="nofollow sponsored noopener" class="btn-primary" style="color: #fff !important; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">
      <span>Check Price on Amazon</span>
    </a>
  </div>

  <p style="text-align:center; margin-top:1rem;">
    <a href={`/best-${product.category}/`}>See all {category?.name} reviews &rarr;</a>
  </p>
</ContentLayout>

<style>
  .best-for-box { padding: 1rem 1.25rem; background: hsl(var(--primary) / 0.06); border: 1px solid hsl(var(--primary) / 0.15); border-radius: 0.75rem; margin: 1.5rem 0; font-size: 0.9375rem; color: hsl(var(--foreground)); }
  .pros-cons-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin: 1.5rem 0; }
  @media (min-width: 768px) { .pros-cons-grid { grid-template-columns: 1fr 1fr; } }
  .pros-list, .cons-list { padding: 1.25rem; border-radius: 0.75rem; border: 1px solid hsl(var(--border)); }
  .pros-list { background: hsl(142 70% 45% / 0.04); border-color: hsl(142 70% 45% / 0.15); }
  .cons-list { background: hsl(0 70% 45% / 0.04); border-color: hsl(0 70% 45% / 0.15); }
  .pros-list h3 { color: hsl(142 70% 45%); font-size: 0.875rem; margin-bottom: 0.75rem; margin-top: 0; }
  .cons-list h3 { color: hsl(0 70% 62%); font-size: 0.875rem; margin-bottom: 0.75rem; margin-top: 0; }
  .pros-list ul, .cons-list ul { list-style: none; padding: 0; margin: 0; }
  .pros-list li, .cons-list li { padding: 0.375rem 0; font-size: 0.9375rem; }
  .verdict-card { text-align: center; padding: 2rem; background: hsl(var(--muted) / 0.3); border: 1px solid hsl(var(--border)); border-radius: 1rem; margin: 1.5rem 0; position: relative; overflow: hidden; }
  .verdict-card::before { content: ''; position: absolute; top: 0; left: 0; width: 200%; height: 3px; background: linear-gradient(90deg, hsl(var(--primary)), hsl(var(--accent)), hsl(var(--primary))); animation: gradient-slide 4s linear infinite; will-change: transform; }
  @keyframes gradient-slide { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
  .specs-table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
  .specs-table td { padding: 0.75rem 1rem; border-bottom: 1px solid hsl(var(--border) / 0.5); font-size: 0.9375rem; color: hsl(var(--muted-foreground)); }
  .specs-table td:first-child { width: 40%; color: hsl(var(--foreground)); }
</style>
