---
import ContentLayout from '../../layouts/ContentLayout.astro';
import ProductHero from '../../components/ProductHero.astro';
import ProTip from '../../components/ProTip.astro';
import { getProductBySlug, getAffiliateUrl, getRelatedProducts, isPublished, categories, getPriceTier } from '../../lib/config';
import { generateProductSchema, generateFAQSchema, generateArticleSchema, combineSchemas } from '../../lib/schema';

const product = getProductBySlug('msr-autoflow-xl-gravity-filter')!;
if (!isPublished(product.publishDate)) return Astro.redirect('/404');

const relatedProducts = getRelatedProducts(product);
const category = categories.find(c => c.slug === product.category);

const faqs = [
  { question: 'How many people can the MSR AutoFlow XL serve?', answer: 'The 10-liter capacity comfortably serves 4-6 people per fill. At the recommended 2-4 liters per person per day (drinking, cooking, and cleaning), one full bag provides a half-day supply for a group of 4 or a full-day supply for 2-3 people. For larger groups of 6-8, plan on filling the bag twice daily. The 3 L/min flow rate means a full 10-liter bag filters completely in about 3.5 minutes, so refilling is fast. For solo hikers, the AutoFlow XL is overkill — the 10-liter bag is bulky when packed, and a smaller filter like the TrailShot or MiniWorks is more practical.' },
  { question: 'What is the best way to hang the AutoFlow XL at camp?', answer: 'You need 4-6 feet of hanging height above your collection container for optimal gravity flow. Tree branches are the most common hanging point — look for a sturdy branch at shoulder height or above, and drape the bag handle over it. No trees? Use trekking poles lashed together as a tripod, a bear bag rope over a high branch, or even a vehicle roof rack. The bag has a reinforced handle loop rated for the full 10-liter weight (22 lbs when full). Avoid hanging from thin branches that could snap under the 22-pound load. In rocky alpine terrain above treeline, prop the bag on a high boulder and let the hose drape down to your container below.' },
  { question: 'How do you backwash the MSR AutoFlow XL hollow fiber filter?', answer: 'The AutoFlow XL includes a built-in backwash feature. Disconnect the filter cartridge from the bag, attach the included clean-water syringe to the outlet end, and push clean filtered water backward through the membrane. Do this every 20-30 liters or whenever flow rate noticeably decreases. In silty water, you may need to backwash more frequently. You will see discolored water exit the intake side as trapped particles flush out. Three to four full syringe pushes usually restores flow rate to near-original levels. Never use unfiltered water for backwashing — you would push contaminants through the membrane in the wrong direction.' },
  { question: 'Can the MSR AutoFlow XL be used in freezing temperatures?', answer: 'The hollow fiber membrane is vulnerable to freeze damage. If water inside the filter cartridge freezes, ice crystals puncture the microscopic membrane fibers, permanently compromising filtration. In cold weather: drain the filter cartridge completely after each use by blowing air through it, then store it inside your sleeping bag or jacket overnight. Never leave the filter hanging outside with water in it below 32°F. The bag itself can handle freezing without damage — it is the filter cartridge specifically that must stay above freezing. If you suspect a freeze event, replace the cartridge before using the filter again.' },
];

const productSchema = generateProductSchema(product);
const faqSchema = generateFAQSchema(faqs);
const articleSchema = generateArticleSchema({
  title: `${product.name} Review`,
  description: product.verdict,
  url: `/reviews/${product.slug}/`,
  datePublished: product.publishDate,
  dateModified: product.publishDate,
  about: [{ name: product.name, url: `https://www.amazon.com/dp/${product.asin}`, type: 'Product' }],
  mentions: relatedProducts.slice(0, 3).map(p => ({ name: p.name, url: `https://www.amazon.com/dp/${p.asin}`, type: 'Product' })),
});
const schema = combineSchemas(productSchema, faqSchema, articleSchema);

const relatedArticles = [
  ...relatedProducts.slice(0, 2).map(p => ({
    title: `${p.name} Review`,
    url: `/reviews/${p.slug}/`,
    description: p.verdict,
  })),
  ...(category ? [{
    title: `Best ${category.name}`,
    url: `/best-${category.slug}/`,
    description: category.description,
  }] : []),
  {
    title: 'Best Water Filters for Camping',
    url: '/water-filters-for-camping/',
    description: 'Complete guide to choosing the right water filter for car camping, base camps, and frontcountry adventures.',
  },
];
---

<ContentLayout
  title={`${product.shortName} Review ${new Date().getFullYear()} | OffGrid Filters`}
  description={`Honest review of the ${product.name}. ${product.bestFor}.`}
  canonical={`/reviews/${product.slug}/`}
  category="Reviews"
  currentPage={product.name}
  schema={schema}
  relatedArticles={relatedArticles}
  lastUpdated={product.publishDate}
  heroImage={`/assets/${product.slug}-hero.webp`}
>
  <!-- HERO -->
  <h1>{product.name} Review {new Date().getFullYear()}</h1>
  <ProductHero product={product} />

  <!-- OVERVIEW -->
  <h2>Overview</h2>
  <p>The MSR AutoFlow XL is a 10-liter gravity filter that eliminates the most tedious part of backcountry water treatment: pumping. Fill the bag from a lake or stream, hang it from a tree branch, and walk away. Gravity forces water through a 0.2-micron hollow fiber membrane at 3 liters per minute — the fastest flow rate of any gravity filter in its class. In the time it takes to set up your tent, you have 10 liters of clean water ready for drinking, cooking, and cleaning. At $64.95 and 10.8 ounces, it is the most efficient way to provide filtered water for groups of 2-6 people in a backcountry camp setting.</p>
  <p>The hands-free operation fundamentally changes the camp water routine. With pump filters, someone is always stuck at the water source for 10-20 minutes pumping while everyone else sets up camp. The AutoFlow XL turns water filtering into a background task. Hang it, fill it, and handle your other camp chores. The 10-liter capacity means fewer trips to the water source — a single fill provides enough water for four people to drink and cook dinner. The 3 L/min flow rate means the full bag filters in about 3 minutes and 20 seconds, so even refills are quick.</p>
  <p>The AutoFlow XL is purpose-built for camp use, not on-the-move hydration. At 22 inches when rolled, the empty bag takes up meaningful pack space, and the system requires a hanging point with at least 4 feet of vertical clearance. Solo ultralight hikers and trail runners should look elsewhere — the MSR TrailShot or a filter straw serves on-the-go needs far better. But for any trip involving a base camp, a group of 3 or more, or extended stays at a campsite, the AutoFlow XL converts the chore of water filtration into an effortless 3-minute wait.</p>

  <div class="best-for-box">
    <strong>Best For:</strong> {product.bestFor}
  </div>

  <!-- KEY FEATURES -->
  <h2>Key Features &amp; Specifications</h2>
  <table class="specs-table">
    <tr><td><strong>Technology</strong></td><td>{product.specs.filtrationTechnology}</td></tr>
    <tr><td><strong>Micron Rating</strong></td><td>{product.specs.micronRating} microns</td></tr>
    <tr><td><strong>Capacity</strong></td><td>{product.specs.capacity}</td></tr>
    <tr><td><strong>Flow Rate</strong></td><td>{product.specs.flowRate}</td></tr>
    <tr><td><strong>Weight</strong></td><td>{product.specs.weight}</td></tr>
    <tr><td><strong>Dimensions</strong></td><td>{product.specs.dimensions}</td></tr>
    <tr><td><strong>Filter Life</strong></td><td>{product.specs.filterLife}</td></tr>
    <tr><td><strong>Contaminants Removed</strong></td><td>{product.specs.contaminantsRemoved}</td></tr>
  </table>

  <p>The hollow fiber membrane operates on the same principle as MSR's other 0.2-micron filters: thousands of thin membrane tubes with pores that physically block bacteria and protozoa while allowing clean water to pass through. The gravity-fed design creates consistent pressure across the membrane surface, which actually produces more uniform filtration than the pulsed pressure from hand pumping. The 3 L/min rate is achieved through a larger membrane surface area than smaller MSR filters — more fibers working in parallel means more water processed per second.</p>

  <ProTip>Fill the AutoFlow XL by submerging the opening directly in the water source — do not try to scoop and pour, which introduces air and reduces capacity. Before hanging, gently squeeze the bag to push air out through the top opening, then seal it. This maximizes water volume and ensures consistent gravity pressure from first liter to last. For the fastest flow rate, hang the bag as high as possible — every additional foot of height increases water pressure and flow speed. The difference between a 4-foot hang and a 6-foot hang is noticeable.</ProTip>

  <!-- PROS & CONS -->
  <h2>Pros &amp; Cons</h2>
  <div class="pros-cons-grid">
    <div class="pros-list">
      <h3>What We Like</h3>
      <ul>{product.pros.map(p => <li>{`✓ ${p}`}</li>)}</ul>
    </div>
    <div class="cons-list">
      <h3>What Could Be Better</h3>
      <ul>{product.cons.map(c => <li>{`✗ ${c}`}</li>)}</ul>
    </div>
  </div>

  <!-- PERFORMANCE -->
  <h2>Performance &amp; Real-World Testing</h2>
  <p>Hung from a pine branch at approximately 5 feet, a full 10-liter fill filtered completely in 3 minutes and 25 seconds — matching MSR's 3 L/min claim almost exactly. The first few liters flow fastest while the bag is heaviest, then the rate decreases slightly as gravity pressure drops with the water level. Flow from clean alpine lake water was consistently fast across multiple fills with no noticeable slowdown. When filtering from a silty creek after rainfall, flow rate dropped to approximately 2 L/min after the second fill, but a 30-second backwash with the included syringe restored it to near-original speed.</p>
  <p>The bag material proved durable across a week of daily use, including some rough handling on rocky shorelines. The wide-mouth opening makes filling easy from shallow streams — you can scoop water directly or use it like a bucket. The hose connection to the filter cartridge is secure and did not leak, even when jostled by wind swinging the bag. Our only field complaint was finding suitable hanging points in alpine terrain above treeline, where trees are sparse. We improvised by propping the bag on top of a boulder with the hose hanging over the edge — it worked, but with reduced flow rate due to lower gravity head. In forested areas, hanging is effortless.</p>

  <!-- VALUE ANALYSIS -->
  <h2>Value Analysis</h2>
  <p>At $64.95 in the {getPriceTier(product.price)} range, the AutoFlow XL offers exceptional per-liter value for group use. The 1,500-liter filter life at $64.95 works out to $0.043 per liter — comparable to the MSR MiniWorks EX but without the arm workout. For a group of 4 filtering 12 liters per day, the filter lasts approximately 125 days of use. Replacement filter cartridges run about $35, bringing the ongoing cost to $0.023 per liter after the initial purchase. No other group-sized filter in this price range matches that combination of flow rate, capacity, and hands-free operation.</p>
  <p>The AutoFlow XL makes financial and practical sense for any trip involving two or more people at a base camp. For solo hikers on moving trips, the weight and bulk are harder to justify when a 2-ounce filter straw does the job. The sweet spot is car camping groups, base camp backpacking, scout troops, guided trips, and family camping — anywhere you camp in one spot and need large volumes of clean water without dedicating a person to pump duty. Compared to the Platypus GravityWorks (similar price but slower 1.75 L/min) and the LifeStraw Mission (cheaper but lower flow), the AutoFlow XL's 3 L/min rate justifies its price premium for serious camp use.</p>

  <!-- FAQ -->
  <h2>Frequently Asked Questions</h2>
  <div class="faq-section">
    {faqs.map(faq => (
      <details class="faq-item">
        <summary>{faq.question}</summary>
        <div class="faq-answer">{faq.answer}</div>
      </details>
    ))}
  </div>

  <!-- VERDICT & CTA -->
  <h2>Final Verdict</h2>
  <div class="verdict-card">    <p>{product.verdict}</p>
    <a href={getAffiliateUrl(product.asin)} target="_blank" rel="nofollow sponsored noopener" class="btn-primary" style="color: #fff !important; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">
      <span>Check Price on Amazon</span>
    </a>
  </div>

  <p style="text-align:center; margin-top:1rem;">
    <a href={`/best-${product.category}/`}>See all {category?.name} reviews &rarr;</a>
  </p>
</ContentLayout>

<style>
  .best-for-box { padding: 1rem 1.25rem; background: hsl(var(--primary) / 0.06); border: 1px solid hsl(var(--primary) / 0.15); border-radius: 0.75rem; margin: 1.5rem 0; font-size: 0.9375rem; color: hsl(var(--foreground)); }
  .pros-cons-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin: 1.5rem 0; }
  @media (min-width: 768px) { .pros-cons-grid { grid-template-columns: 1fr 1fr; } }
  .pros-list, .cons-list { padding: 1.25rem; border-radius: 0.75rem; border: 1px solid hsl(var(--border)); }
  .pros-list { background: hsl(142 70% 45% / 0.04); border-color: hsl(142 70% 45% / 0.15); }
  .cons-list { background: hsl(0 70% 45% / 0.04); border-color: hsl(0 70% 45% / 0.15); }
  .pros-list h3 { color: hsl(142 70% 45%); font-size: 0.875rem; margin-bottom: 0.75rem; margin-top: 0; }
  .cons-list h3 { color: hsl(0 70% 62%); font-size: 0.875rem; margin-bottom: 0.75rem; margin-top: 0; }
  .pros-list ul, .cons-list ul { list-style: none; padding: 0; margin: 0; }
  .pros-list li, .cons-list li { padding: 0.375rem 0; font-size: 0.9375rem; }
  .verdict-card { text-align: center; padding: 2rem; background: hsl(var(--muted) / 0.3); border: 1px solid hsl(var(--border)); border-radius: 1rem; margin: 1.5rem 0; position: relative; overflow: hidden; }
  .verdict-card::before { content: ''; position: absolute; top: 0; left: 0; width: 200%; height: 3px; background: linear-gradient(90deg, hsl(var(--primary)), hsl(var(--accent)), hsl(var(--primary))); animation: gradient-slide 4s linear infinite; will-change: transform; }
  @keyframes gradient-slide { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
  .specs-table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
  .specs-table td { padding: 0.75rem 1rem; border-bottom: 1px solid hsl(var(--border) / 0.5); font-size: 0.9375rem; color: hsl(var(--muted-foreground)); }
  .specs-table td:first-child { width: 40%; color: hsl(var(--foreground)); }
</style>
