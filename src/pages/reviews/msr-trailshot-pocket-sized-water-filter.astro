---
import ContentLayout from '../../layouts/ContentLayout.astro';
import ProductHero from '../../components/ProductHero.astro';
import ProTip from '../../components/ProTip.astro';
import { getProductBySlug, getAffiliateUrl, getRelatedProducts, isPublished, categories, getPriceTier } from '../../lib/config';
import { generateProductSchema, generateFAQSchema, generateArticleSchema, combineSchemas } from '../../lib/schema';

const product = getProductBySlug('msr-trailshot-pocket-sized-water-filter')!;
if (!isPublished(product.publishDate)) return Astro.redirect('/404');

const relatedProducts = getRelatedProducts(product);
const category = categories.find(c => c.slug === product.category);

const faqs = [
  { question: 'Can you use the MSR TrailShot as both a straw and a pump?', answer: 'Yes. The TrailShot has two modes of operation. In straw mode, you submerge the intake hose in a water source and drink directly from the filter outlet — similar to a LifeStraw but with a flexible hose that reaches the water. In pump mode, you squeeze the bulb handle to push filtered water into a bottle, hydration reservoir, or cooking pot. Pump mode is more practical for filling containers, while straw mode works well for quick drinks at creek crossings when you do not want to stop and fill a bottle.' },
  { question: 'How does the MSR TrailShot perform in shallow water sources?', answer: 'The TrailShot works in water as shallow as 2-3 inches thanks to its flexible intake hose and small pre-filter screen. However, very shallow or stagnant water requires more patience — you may need to hold the intake tip at a specific angle to avoid sucking air. In puddles or very shallow streams, press the pre-filter screen flat against the bottom and pump slowly. The pre-filter catches large debris before it reaches the hollow fiber membrane, but silty shallow sources will clog the filter faster than clear flowing water.' },
  { question: 'Is the MSR TrailShot good for trail running?', answer: 'The TrailShot is one of the best filters for trail runners due to its compact size (7.4 x 2.2 inches) and 5.2 oz weight. It fits easily in a running vest pocket or shorts pocket. At creek crossings, you can kneel down, dip the hose in, and pump a few mouthfuls in seconds without removing your pack. The straw mode is especially useful for quick drinks on the move. The main limitation is volume — if you need to fill a full 1-liter bottle, you will spend about 60 seconds pumping, which is fine for most trail runners but slower than a gravity system.' },
  { question: 'Can the MSR TrailShot handle cold weather and freezing temperatures?', answer: 'The TrailShot uses a hollow fiber membrane that is vulnerable to freeze damage. If water inside the filter freezes, the expanding ice crystals rupture the microscopic membrane fibers, creating holes larger than 0.2 microns and rendering the filter unsafe. In cold weather, keep the TrailShot inside your jacket pocket or sleeping bag when not in use. Never leave it outside overnight in freezing conditions. If you suspect the filter has frozen, replace it — there is no way to visually confirm membrane integrity after a freeze event. MSR does not warranty freeze damage.' },
];

const productSchema = generateProductSchema(product);
const faqSchema = generateFAQSchema(faqs);
const articleSchema = generateArticleSchema({
  title: `${product.name} Review`,
  description: product.verdict,
  url: `/reviews/${product.slug}/`,
  datePublished: product.publishDate,
  dateModified: product.publishDate,
  about: [{ name: product.name, url: `https://www.amazon.com/dp/${product.asin}`, type: 'Product' }],
  mentions: relatedProducts.slice(0, 3).map(p => ({ name: p.name, url: `https://www.amazon.com/dp/${p.asin}`, type: 'Product' })),
});
const schema = combineSchemas(productSchema, faqSchema, articleSchema);

const relatedArticles = [
  ...relatedProducts.slice(0, 2).map(p => ({
    title: `${p.name} Review`,
    url: `/reviews/${p.slug}/`,
    description: p.verdict,
  })),
  ...(category ? [{
    title: `Best ${category.name}`,
    url: `/best-${category.slug}/`,
    description: category.description,
  }] : []),
  {
    title: 'Best Water Filters for Hiking',
    url: '/water-filters-for-hiking/',
    description: 'Lightweight, fast-filtering options for day hikes, thru-hikes, and trail running.',
  },
];
---

<ContentLayout
  title={`${product.shortName} Review ${new Date().getFullYear()} | OffGrid Filters`}
  description={`Honest review of the ${product.name}. ${product.bestFor}.`}
  canonical={`/reviews/${product.slug}/`}
  category="Reviews"
  currentPage={product.name}
  schema={schema}
  relatedArticles={relatedArticles}
  lastUpdated={product.publishDate}
  heroImage={`/assets/${product.slug}-hero.webp`}
>
  <!-- HERO -->
  <h1>{product.name} Review {new Date().getFullYear()}</h1>
  <ProductHero product={product} />

  <!-- OVERVIEW -->
  <h2>Overview</h2>
  <p>The MSR TrailShot is a pocket-sized pump filter that challenges the assumption that backcountry water treatment requires a full-sized filter or a floppy bag-and-squeeze setup. At 5.2 ounces and $44.95, it slides into a hip-belt pocket or running vest and gives you on-demand filtered water from any stream, lake, or puddle. The dual-mode design — use it as a straw to drink directly or pump filtered water into a container — makes it one of the most versatile ultralight filters on the market.</p>
  <p>The 0.2-micron hollow fiber membrane removes bacteria at 99.9999% and protozoa at 99.9%, matching the filtration performance of filters two and three times its size. The pump mechanism is a squeezable bulb rather than a traditional piston pump, which means less mechanical complexity but also less pumping leverage. You get about 1 liter per minute with consistent squeezing — competitive for the size class, but you will feel it in your hand after filling multiple bottles. MSR designed the TrailShot for quick, low-volume use: drink at a creek crossing, top off a single bottle, and keep moving.</p>
  <p>Where the TrailShot excels is spontaneity. Traditional pump filters require you to stop, unpack, assemble hoses, and dedicate 5-10 minutes to water collection. The TrailShot lives in your pocket and deploys in seconds — drop the intake hose into moving water and start squeezing. For trail runners, fastpackers, and minimalist day hikers who cross multiple water sources, this quick-draw capability is transformative. The trade-off is that it is not designed for high-volume camp filtration — if you need to filter water for a group or for cooking, look at the MSR AutoFlow XL gravity system instead.</p>

  <div class="best-for-box">
    <strong>Best For:</strong> {product.bestFor}
  </div>

  <!-- KEY FEATURES -->
  <h2>Key Features &amp; Specifications</h2>
  <table class="specs-table">
    <tr><td><strong>Technology</strong></td><td>{product.specs.filtrationTechnology}</td></tr>
    <tr><td><strong>Micron Rating</strong></td><td>{product.specs.micronRating} microns</td></tr>
    <tr><td><strong>Capacity</strong></td><td>{product.specs.capacity}</td></tr>
    <tr><td><strong>Flow Rate</strong></td><td>{product.specs.flowRate}</td></tr>
    <tr><td><strong>Weight</strong></td><td>{product.specs.weight}</td></tr>
    <tr><td><strong>Dimensions</strong></td><td>{product.specs.dimensions}</td></tr>
    <tr><td><strong>Contaminants Removed</strong></td><td>{product.specs.contaminantsRemoved}</td></tr>
  </table>

  <p>The hollow fiber membrane inside the TrailShot is the same proven 0.2-micron technology found in larger MSR filters. The membrane consists of thousands of hollow tubes, each with microscopic pores that physically block anything larger than 0.2 microns — this includes all bacteria (smallest pathogenic bacteria are 0.2 microns) and protozoan cysts like Giardia (8-12 microns) and Cryptosporidium (4-6 microns). It does not remove viruses (0.02-0.3 microns) or dissolved chemicals, so if you are traveling in regions with viral contamination risk, pair the TrailShot with purification tablets.</p>

  <ProTip>The TrailShot's backwash feature is critical for maintaining flow rate on multi-day trips. After filtering from silty sources, flip the filter upside down and squeeze the bulb 3-4 times to force clean water backward through the membrane, flushing out trapped particles. Do this every 5-10 liters or whenever you notice flow rate dropping. Also: in straw mode, suck gently and steadily — aggressive suction can collapse the hollow fibers temporarily and reduce flow. Think of it like drinking a thick milkshake: slow and steady wins.</ProTip>

  <!-- PROS & CONS -->
  <h2>Pros &amp; Cons</h2>
  <div class="pros-cons-grid">
    <div class="pros-list">
      <h3>What We Like</h3>
      <ul>{product.pros.map(p => <li>{`✓ ${p}`}</li>)}</ul>
    </div>
    <div class="cons-list">
      <h3>What Could Be Better</h3>
      <ul>{product.cons.map(c => <li>{`✗ ${c}`}</li>)}</ul>
    </div>
  </div>

  <!-- PERFORMANCE -->
  <h2>Performance &amp; Real-World Testing</h2>
  <p>In clear mountain streams, the TrailShot pumps at its rated 1 L/min without issue. The bulb-squeeze mechanism takes some practice — the most efficient technique is a rhythmic squeeze-release-squeeze at about one cycle per second. In straw mode, flow is slightly slower because you are generating suction with your lungs instead of mechanical force, but it is still fast enough for comfortable drinking. The flexible intake hose reaches water sources easily, and the pre-filter screen at the tip catches leaves, sand, and large debris before they can clog the membrane.</p>
  <p>Where the TrailShot showed its limits was sustained volume. Filtering 3 liters for dinner and morning water at camp required about 5 minutes of continuous hand pumping, and hand fatigue was noticeable by the second liter. This is not a criticism — the TrailShot is designed for on-the-go sipping, not camp water duty. For that, a gravity filter like the AutoFlow XL is purpose-built. The TrailShot's sweet spot is exactly what MSR intended: quick drinks at water crossings, topping off a 500ml soft flask during a trail run, or as a lightweight backup filter on a trip where your primary is a gravity system.</p>

  <!-- VALUE ANALYSIS -->
  <h2>Value Analysis</h2>
  <p>At $44.95, the TrailShot sits in the {getPriceTier(product.price)} tier — more expensive than a $7 Membrane Solutions filter straw but cheaper than the $90 MSR MiniWorks EX or $65 MSR AutoFlow XL. For the price, you get a pump mechanism (filter straws are suction-only), backwashable hollow fiber, and the MSR brand's quality assurance and warranty. The 2,000-liter rated life works out to $0.022 per liter — very reasonable for a branded pump filter.</p>
  <p>The TrailShot makes financial sense as a dedicated day-hike and trail-running filter. If you already own a gravity filter for camp use, the TrailShot is an excellent pocket companion for the trail itself. It also works well as a first backcountry water filter for someone who is not ready to invest in a full pump system. Where it is harder to justify is as your only filter for multi-day trips where you need to filter large volumes daily — the hand fatigue and 1 L/min rate become limiting factors over a week. For those trips, the extra investment in a MiniWorks EX or AutoFlow XL pays for itself in convenience.</p>

  <!-- FAQ -->
  <h2>Frequently Asked Questions</h2>
  <div class="faq-section">
    {faqs.map(faq => (
      <details class="faq-item">
        <summary>{faq.question}</summary>
        <div class="faq-answer">{faq.answer}</div>
      </details>
    ))}
  </div>

  <!-- VERDICT & CTA -->
  <h2>Final Verdict</h2>
  <div class="verdict-card">    <p>{product.verdict}</p>
    <a href={getAffiliateUrl(product.asin)} target="_blank" rel="nofollow sponsored noopener" class="btn-primary" style="color: #fff !important; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">
      <span>Check Price on Amazon</span>
    </a>
  </div>

  <p style="text-align:center; margin-top:1rem;">
    <a href={`/best-${product.category}/`}>See all {category?.name} reviews &rarr;</a>
  </p>
</ContentLayout>

<style>
  .best-for-box { padding: 1rem 1.25rem; background: hsl(var(--primary) / 0.06); border: 1px solid hsl(var(--primary) / 0.15); border-radius: 0.75rem; margin: 1.5rem 0; font-size: 0.9375rem; color: hsl(var(--foreground)); }
  .pros-cons-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin: 1.5rem 0; }
  @media (min-width: 768px) { .pros-cons-grid { grid-template-columns: 1fr 1fr; } }
  .pros-list, .cons-list { padding: 1.25rem; border-radius: 0.75rem; border: 1px solid hsl(var(--border)); }
  .pros-list { background: hsl(142 70% 45% / 0.04); border-color: hsl(142 70% 45% / 0.15); }
  .cons-list { background: hsl(0 70% 45% / 0.04); border-color: hsl(0 70% 45% / 0.15); }
  .pros-list h3 { color: hsl(142 70% 45%); font-size: 0.875rem; margin-bottom: 0.75rem; margin-top: 0; }
  .cons-list h3 { color: hsl(0 70% 62%); font-size: 0.875rem; margin-bottom: 0.75rem; margin-top: 0; }
  .pros-list ul, .cons-list ul { list-style: none; padding: 0; margin: 0; }
  .pros-list li, .cons-list li { padding: 0.375rem 0; font-size: 0.9375rem; }
  .verdict-card { text-align: center; padding: 2rem; background: hsl(var(--muted) / 0.3); border: 1px solid hsl(var(--border)); border-radius: 1rem; margin: 1.5rem 0; position: relative; overflow: hidden; }
  .verdict-card::before { content: ''; position: absolute; top: 0; left: 0; width: 200%; height: 3px; background: linear-gradient(90deg, hsl(var(--primary)), hsl(var(--accent)), hsl(var(--primary))); animation: gradient-slide 4s linear infinite; will-change: transform; }
  @keyframes gradient-slide { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
  .specs-table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
  .specs-table td { padding: 0.75rem 1rem; border-bottom: 1px solid hsl(var(--border) / 0.5); font-size: 0.9375rem; color: hsl(var(--muted-foreground)); }
  .specs-table td:first-child { width: 40%; color: hsl(var(--foreground)); }
</style>
